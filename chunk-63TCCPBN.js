import{a as Zt,b as Jt,c as qt}from"./chunk-OSFVWQ5Z.js";import{$ as Be,D as wt,Da as Pe,Ea as Bt,Ja as Pt,Ka as Vt,Ma as Rt,N as ue,Na as Ft,O as W,T as ne,V as re,W as Oe,X as Se,Y as Et,a as te,aa as Dt,ca as xt,e as Tt,fa as Mt,gb as Ht,ha as bt,hb as Qt,ib as jt,ja as It,jb as Kt,m as Ae,ma as At,n as Le,pa as Lt,qa as Ot,tb as Ve,ub as Gt,vb as Ut,wb as $t,xb as se,y as Ce,yb as Wt}from"./chunk-P3XE2YTL.js";import{d as yt,o as Nt,p as Ie,q as Ge,t as _t}from"./chunk-WV4YJ4QP.js";import{$b as De,A as P,Ab as me,Ba as F,Bb as u,Ca as w,Cb as G,Da as E,Db as _,E as Fe,Eb as dt,Gb as ht,Ha as _e,Hb as D,Ib as pt,Ic as U,Ja as f,Jb as fe,Ka as Te,Kb as q,L as it,Lb as Y,Ma as we,Mb as z,Mc as c,Nb as C,Nc as vt,Ob as S,Pb as le,Qb as de,Sb as H,Ub as ut,Yb as B,Z as nt,Zb as gt,_ as b,_b as l,ac as xe,bc as mt,c as m,cb as at,cc as ie,db as Ee,dc as X,ec as ee,f as $,fa as rt,fc as he,g as et,ga as L,gb as h,gc as pe,ha as j,hb as N,hc as ft,ic as zt,ja as st,jc as Ct,la as M,lc as He,m as Z,ma as J,mc as Qe,nb as ct,nc as je,oc as Me,pc as A,ra as I,rc as Ke,s as d,sa as K,sb as lt,sc as be,t as ye,ta as Ne,tc as St,ua as ot,ub as V,wc as kt,xb as v,xc as ze,z as tt}from"./chunk-NPSVTU3I.js";import{a as R,e as g}from"./chunk-JKOY2XUY.js";var Ei=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,Di=/([^\#-~ |!])/g;function xi(n){return n.replace(/&/g,"&amp;").replace(Ei,o=>{let e=o.charCodeAt(0),t=o.charCodeAt(1);return`&#${(e-55296)*1024+(t-56320)+65536};`}).replace(Di,o=>`&#${o.charCodeAt(0)};`).replace(/</g,"&lt;").replace(/>/g,"&gt;")}var Yt=(()=>{class n{constructor(){this.UNIQUE_WRAPPERS=["##==-open_tag-==##","##==-close_tag-==##"]}transform(e,t,i,r){if(!t)return e;let s=new RegExp(t.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$&"),i),a=e.replace(s,`${this.UNIQUE_WRAPPERS[0]}$&${this.UNIQUE_WRAPPERS[1]}`);return xi(a).replace(new RegExp(this.UNIQUE_WRAPPERS[0],"g"),r?`<span class="${r}">`:"<span>").replace(new RegExp(this.UNIQUE_WRAPPERS[1],"g"),"</span>")}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275pipe=ot({name:"nzHighlight",type:n,pure:!0,standalone:!0})}}return n})(),Xt=(()=>{class n{static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275mod=K({type:n})}static{this.\u0275inj=j({})}}return n})();var oe=class n{get treeService(){return this.service||this.parentNode&&this.parentNode.treeService}constructor(o,e=null,t=null){if(this._title="",this.level=0,this.parentNode=null,this._icon="",this._children=[],this._isLeaf=!1,this._isChecked=!1,this._isSelectable=!1,this._isDisabled=!1,this._isDisableCheckbox=!1,this._isExpanded=!1,this._isHalfChecked=!1,this._isSelected=!1,this._isLoading=!1,this.canHide=!1,this.isMatched=!1,this.service=null,o instanceof n)return o;this.service=t||null,this.origin=o,this.key=o.key,this.parentNode=e,this._title=o.title||"---",this._icon=o.icon||"",this._isLeaf=o.isLeaf||!1,this._children=[],this._isChecked=o.checked||!1,this._isSelectable=o.disabled||o.selectable!==!1,this._isDisabled=o.disabled||!1,this._isDisableCheckbox=o.disableCheckbox||!1,this._isExpanded=o.isLeaf?!1:o.expanded||!1,this._isHalfChecked=!1,this._isSelected=!o.disabled&&o.selected||!1,this._isLoading=!1,this.isMatched=!1,e?this.level=e.level+1:this.level=0,typeof o.children<"u"&&o.children!==null&&o.children.forEach(i=>{let r=this.treeService;r&&!r.isCheckStrictly&&o.checked&&!o.disabled&&!i.disabled&&!i.disableCheckbox&&(i.checked=o.checked),this._children.push(new n(i,this))})}get title(){return this._title}set title(o){this._title=o,this.update()}get icon(){return this._icon}set icon(o){this._icon=o,this.update()}get children(){return this._children}set children(o){this._children=o,this.update()}get isLeaf(){return this._isLeaf}set isLeaf(o){this._isLeaf=o,this.update()}get isChecked(){return this._isChecked}set isChecked(o){this._isChecked=o,this.origin.checked=o,this.afterValueChange("isChecked")}get isHalfChecked(){return this._isHalfChecked}set isHalfChecked(o){this._isHalfChecked=o,this.afterValueChange("isHalfChecked")}get isSelectable(){return this._isSelectable}set isSelectable(o){this._isSelectable=o,this.update()}get isDisabled(){return this._isDisabled}set isDisabled(o){this._isDisabled=o,this.update()}get isDisableCheckbox(){return this._isDisableCheckbox}set isDisableCheckbox(o){this._isDisableCheckbox=o,this.update()}get isExpanded(){return this._isExpanded}set isExpanded(o){this._isExpanded=o,this.origin.expanded=o,this.afterValueChange("isExpanded"),this.afterValueChange("reRender")}get isSelected(){return this._isSelected}set isSelected(o){this._isSelected=o,this.origin.selected=o,this.afterValueChange("isSelected")}get isLoading(){return this._isLoading}set isLoading(o){this._isLoading=o,this.update()}setSyncChecked(o=!1,e=!1){this.setChecked(o,e),this.treeService&&!this.treeService.isCheckStrictly&&this.treeService.conduct(this)}setChecked(o=!1,e=!1){this.origin.checked=o,this.isChecked=o,this.isHalfChecked=e}setExpanded(o){this._isExpanded=o,this.origin.expanded=o,this.afterValueChange("isExpanded")}getParentNode(){return this.parentNode}getChildren(){return this.children}addChildren(o,e=-1){this.isLeaf||(o.forEach(t=>{let i=s=>{s.getChildren().forEach(a=>{a.level=a.getParentNode().level+1,a.origin.level=a.level,i(a)})},r=t;r instanceof n?r.parentNode=this:r=new n(t,this),r.level=this.level+1,r.origin.level=r.level,i(r);try{e===-1?this.children.push(r):this.children.splice(e,0,r)}catch{}}),this.origin.children=this.getChildren().map(t=>t.origin),this.isLoading=!1),this.afterValueChange("addChildren"),this.afterValueChange("reRender")}clearChildren(){this.afterValueChange("clearChildren"),this.children=[],this.origin.children=[],this.afterValueChange("reRender")}remove(){let o=this.getParentNode();o&&(o.children=o.getChildren().filter(e=>e.key!==this.key),o.origin.children=o.origin.children.filter(e=>e.key!==this.key),this.afterValueChange("remove"),this.afterValueChange("reRender"))}afterValueChange(o){if(this.treeService)switch(o){case"isChecked":this.treeService.setCheckedNodeList(this);break;case"isHalfChecked":this.treeService.setHalfCheckedNodeList(this);break;case"isExpanded":this.treeService.setExpandedNodeList(this);break;case"isSelected":this.treeService.setNodeActive(this);break;case"clearChildren":this.treeService.afterRemove(this.getChildren());break;case"remove":this.treeService.afterRemove([this]);break;case"reRender":this.treeService.flattenTreeData(this.treeService.rootNodes,this.treeService.getExpandedNodeList().map(e=>e.key));break}this.update()}update(){this.component&&this.component.markForCheck()}};function Ue(n){let{isDisabled:o,isDisableCheckbox:e}=n;return!!(o||e)}function ei(n,o){return o.length>0&&o.indexOf(n)>-1}function bi(n,o){return`${n}-${o}`}function Ii(n,o){return n??o}function $e(n=[],o=[]){let e=new Set(o===!0?[]:o),t=[];function i(r,s=null){return r.map((a,p)=>{let k=bi(s?s.pos:"0",p),T=Ii(a.key,k);a.isStart=[...s?s.isStart:[],p===0],a.isEnd=[...s?s.isEnd:[],p===r.length-1];let y={parent:s,pos:k,children:[],data:a,isStart:[...s?s.isStart:[],p===0],isEnd:[...s?s.isEnd:[],p===r.length-1]};return t.push(y),o===!0||e.has(T)||a.isExpanded?y.children=i(a.children||[],y):y.children=[],y})}return i(n),t}var ge=(()=>{class n{constructor(){this.DRAG_SIDE_RANGE=.25,this.DRAG_MIN_GAP=2,this.isCheckStrictly=!1,this.isMultiple=!1,this.rootNodes=[],this.flattenNodes$=new et([]),this.selectedNodeList=[],this.expandedNodeList=[],this.checkedNodeList=[],this.halfCheckedNodeList=[],this.matchedNodeList=[]}initTree(e){this.rootNodes=e,this.expandedNodeList=[],this.selectedNodeList=[],this.halfCheckedNodeList=[],this.checkedNodeList=[],this.matchedNodeList=[]}flattenTreeData(e,t=[]){this.flattenNodes$.next($e(e,t).map(i=>i.data))}getSelectedNode(){return this.selectedNode}getSelectedNodeList(){return this.conductNodeState("select")}getCheckedNodeKeys(){let e=[],t=this.getCheckedNodeList(),i=r=>{r.forEach(s=>{e.push(s.key),!(s.children.length<1)&&i(s.children)})};return i(t),e}getCheckedNodeList(){return this.conductNodeState("check")}getHalfCheckedNodeList(){return this.conductNodeState("halfCheck")}getExpandedNodeList(){return this.conductNodeState("expand")}getMatchedNodeList(){return this.conductNodeState("match")}isArrayOfNzTreeNode(e){return e.every(t=>t instanceof oe)}setSelectedNode(e){this.selectedNode=e}setNodeActive(e){!this.isMultiple&&e.isSelected&&(this.selectedNodeList.forEach(t=>{e.key!==t.key&&(t.isSelected=!1)}),this.selectedNodeList=[]),this.setSelectedNodeList(e,this.isMultiple)}setSelectedNodeList(e,t=!1){let i=this.getIndexOfArray(this.selectedNodeList,e.key);t?e.isSelected&&i===-1&&this.selectedNodeList.push(e):e.isSelected&&i===-1&&(this.selectedNodeList=[e]),e.isSelected||(this.selectedNodeList=this.selectedNodeList.filter(r=>r.key!==e.key))}setHalfCheckedNodeList(e){let t=this.getIndexOfArray(this.halfCheckedNodeList,e.key);e.isHalfChecked&&t===-1?this.halfCheckedNodeList.push(e):!e.isHalfChecked&&t>-1&&(this.halfCheckedNodeList=this.halfCheckedNodeList.filter(i=>e.key!==i.key))}setCheckedNodeList(e){let t=this.getIndexOfArray(this.checkedNodeList,e.key);e.isChecked&&t===-1?this.checkedNodeList.push(e):!e.isChecked&&t>-1&&(this.checkedNodeList=this.checkedNodeList.filter(i=>e.key!==i.key))}conductNodeState(e="check"){let t=[];switch(e){case"select":t=this.selectedNodeList;break;case"expand":t=this.expandedNodeList;break;case"match":t=this.matchedNodeList;break;case"check":t=this.checkedNodeList;let i=r=>{let s=r.getParentNode();return s?this.checkedNodeList.findIndex(a=>a.key===s.key)>-1?!0:i(s):!1};this.isCheckStrictly||(t=this.checkedNodeList.filter(r=>!i(r)));break;case"halfCheck":this.isCheckStrictly||(t=this.halfCheckedNodeList);break}return t}setExpandedNodeList(e){if(e.isLeaf)return;let t=this.getIndexOfArray(this.expandedNodeList,e.key);e.isExpanded&&t===-1?this.expandedNodeList.push(e):!e.isExpanded&&t>-1&&this.expandedNodeList.splice(t,1)}setMatchedNodeList(e){let t=this.getIndexOfArray(this.matchedNodeList,e.key);e.isMatched&&t===-1?this.matchedNodeList.push(e):!e.isMatched&&t>-1&&this.matchedNodeList.splice(t,1)}refreshCheckState(e=!1){e||this.checkedNodeList.forEach(t=>{this.conduct(t,e)})}conduct(e,t=!1){let i=e.isChecked;e&&!t&&(this.conductUp(e),this.conductDown(e,i))}conductUp(e){let t=e.getParentNode();t&&(Ue(t)||(t.children.every(i=>Ue(i)||!i.isHalfChecked&&i.isChecked)?(t.isChecked=!0,t.isHalfChecked=!1):t.children.some(i=>i.isHalfChecked||i.isChecked)?(t.isChecked=!1,t.isHalfChecked=!0):(t.isChecked=!1,t.isHalfChecked=!1)),this.setCheckedNodeList(t),this.setHalfCheckedNodeList(t),this.conductUp(t))}conductDown(e,t){Ue(e)||(e.isChecked=t,e.isHalfChecked=!1,this.setCheckedNodeList(e),this.setHalfCheckedNodeList(e),e.children.forEach(i=>{this.conductDown(i,t)}))}afterRemove(e){let t=i=>{this.selectedNodeList=this.selectedNodeList.filter(r=>r.key!==i.key),this.expandedNodeList=this.expandedNodeList.filter(r=>r.key!==i.key),this.checkedNodeList=this.checkedNodeList.filter(r=>r.key!==i.key),i.children&&i.children.forEach(r=>{t(r)})};e.forEach(i=>{t(i)}),this.refreshCheckState(this.isCheckStrictly)}refreshDragNode(e){e.children.length===0?this.conductUp(e):e.children.forEach(t=>{this.refreshDragNode(t)})}resetNodeLevel(e){let t=e.getParentNode();t?e.level=t.level+1:e.level=0;for(let i of e.children)this.resetNodeLevel(i)}calcDropPosition(e){let{clientY:t}=e,{top:i,bottom:r,height:s}=e.target.getBoundingClientRect(),a=Math.max(s*this.DRAG_SIDE_RANGE,this.DRAG_MIN_GAP);return t<=i+a?-1:t>=r-a?1:0}dropAndApply(e,t=-1){if(!e||t>1)return;let i=e.treeService,r=e.getParentNode(),s=this.selectedNode.getParentNode();switch(s?s.children=s.children.filter(a=>a.key!==this.selectedNode.key):this.rootNodes=this.rootNodes.filter(a=>a.key!==this.selectedNode.key),t){case 0:e.addChildren([this.selectedNode]),this.resetNodeLevel(e);break;case-1:case 1:let a=t===1?1:0;if(r){r.addChildren([this.selectedNode],r.children.indexOf(e)+a);let p=this.selectedNode.getParentNode();p&&this.resetNodeLevel(p)}else{let p=this.rootNodes.indexOf(e)+a;this.rootNodes.splice(p,0,this.selectedNode),this.rootNodes[p].parentNode=null,this.resetNodeLevel(this.rootNodes[p])}break}this.rootNodes.forEach(a=>{a.treeService||(a.service=i),this.refreshDragNode(a)})}formatEvent(e,t,i){let r={eventName:e,node:t,event:i};switch(e){case"dragstart":case"dragenter":case"dragover":case"dragleave":case"drop":case"dragend":Object.assign(r,{dragNode:this.getSelectedNode()});break;case"click":case"dblclick":Object.assign(r,{selectedKeys:this.selectedNodeList}),Object.assign(r,{nodes:this.selectedNodeList}),Object.assign(r,{keys:this.selectedNodeList.map(a=>a.key)});break;case"check":let s=this.getCheckedNodeList();Object.assign(r,{checkedKeys:s}),Object.assign(r,{nodes:s}),Object.assign(r,{keys:s.map(a=>a.key)});break;case"search":Object.assign(r,{matchedKeys:this.getMatchedNodeList()}),Object.assign(r,{nodes:this.getMatchedNodeList()}),Object.assign(r,{keys:this.getMatchedNodeList().map(a=>a.key)});break;case"expand":Object.assign(r,{nodes:this.expandedNodeList}),Object.assign(r,{keys:this.expandedNodeList.map(a=>a.key)});break}return r}getIndexOfArray(e,t){return e.findIndex(i=>i.key===t)}conductCheck(e,t){this.checkedNodeList=[],this.halfCheckedNodeList=[];let i=r=>{r.forEach(s=>{e===null?s.isChecked=!!s.origin.checked:ei(s.key,e||[])?(s.isChecked=!0,s.isHalfChecked=!1):(s.isChecked=!1,s.isHalfChecked=!1),s.children.length>0&&i(s.children)})};i(this.rootNodes),this.refreshCheckState(t)}conductExpandedKeys(e=[]){let t=new Set(e===!0?[]:e);this.expandedNodeList=[];let i=r=>{r.forEach(s=>{s.setExpanded(e===!0||t.has(s.key)||s.isExpanded===!0),s.isExpanded&&this.setExpandedNodeList(s),s.children.length>0&&i(s.children)})};i(this.rootNodes)}conductSelectedKeys(e,t){this.selectedNodeList.forEach(r=>r.isSelected=!1),this.selectedNodeList=[];let i=r=>r.every(s=>{if(ei(s.key,e)){if(s.isSelected=!0,this.setSelectedNodeList(s),!t)return!1}else s.isSelected=!1;return s.children.length>0?i(s.children):!0});i(this.rootNodes)}expandNodeAllParentBySearch(e){let t=i=>{if(i&&(i.canHide=!1,i.setExpanded(!0),this.setExpandedNodeList(i),i.getParentNode()))return t(i.getParentNode())};t(e.getParentNode())}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=L({token:n,factory:n.\u0275fac})}}return n})(),ti=new st("NzTreeHigherOrder"),Re=class{constructor(o){this.nzTreeService=o}coerceTreeNodes(o){let e=[];return this.nzTreeService.isArrayOfNzTreeNode(o)?e=o.map(t=>(t.service=this.nzTreeService,t)):e=o.map(t=>new oe(t,null,this.nzTreeService)),e}getTreeNodes(){return this.nzTreeService.rootNodes}getTreeNodeByKey(o){let e=[],t=i=>{e.push(i),i.getChildren().forEach(r=>{t(r)})};return this.getTreeNodes().forEach(i=>{t(i)}),e.find(i=>i.key===o)||null}getCheckedNodeList(){return this.nzTreeService.getCheckedNodeList()}getSelectedNodeList(){return this.nzTreeService.getSelectedNodeList()}getHalfCheckedNodeList(){return this.nzTreeService.getHalfCheckedNodeList()}getExpandedNodeList(){return this.nzTreeService.getExpandedNodeList()}getMatchedNodeList(){return this.nzTreeService.getMatchedNodeList()}};function Pi(n,o){if(n&1&&S(0,"span"),n&2){let e=o.$index,t=l();_("ant-tree-indent-unit",!t.nzSelectMode)("ant-select-tree-indent-unit",t.nzSelectMode)("ant-select-tree-indent-unit-start",t.nzSelectMode&&t.nzIsStart[e])("ant-tree-indent-unit-start",!t.nzSelectMode&&t.nzIsStart[e])("ant-select-tree-indent-unit-end",t.nzSelectMode&&t.nzIsEnd[e])("ant-tree-indent-unit-end",!t.nzSelectMode&&t.nzIsEnd[e])}}var ni=["builtin",""],Ze=(n,o)=>({$implicit:n,origin:o});function Vi(n,o){if(n&1&&(le(0),S(1,"span",2),de()),n&2){let e=l(3);h(),_("ant-select-tree-switcher-icon",e.nzSelectMode)("ant-tree-switcher-icon",!e.nzSelectMode)}}function Ri(n,o){if(n&1&&v(0,Vi,2,4,"ng-container",1),n&2){let e=l(2);u("nzStringTemplateOutlet",e.nzExpandedIcon)("nzStringTemplateOutletContext",be(2,Ze,e.context,e.context.origin))}}function Fi(n,o){n&1&&S(0,"span",0),n&2&&u("nzSpin",!0)}function Hi(n,o){if(n&1&&v(0,Ri,1,5,"ng-container")(1,Fi,1,1,"span",0),n&2){let e=l();D(e.isLoading?1:0)}}function Qi(n,o){if(n&1&&S(0,"span",3),n&2){let e=l(4);u("nzType",e.isSwitcherOpen?"minus-square":"plus-square")}}function ji(n,o){n&1&&S(0,"span",4)}function Ki(n,o){if(n&1&&(le(0),v(1,Qi,1,1,"span",3)(2,ji,1,0,"span",4),de()),n&2){let e=l(3);h(),D(e.isShowLineIcon?1:2)}}function Gi(n,o){if(n&1&&v(0,Ki,3,1,"ng-container",1),n&2){let e=l(2);u("nzStringTemplateOutlet",e.nzExpandedIcon)("nzStringTemplateOutletContext",be(2,Ze,e.context,e.context.origin))}}function Ui(n,o){n&1&&S(0,"span",0),n&2&&u("nzSpin",!0)}function $i(n,o){if(n&1&&v(0,Gi,1,5,"ng-container")(1,Ui,1,1,"span",0),n&2){let e=l();D(e.isLoading?1:0)}}function Zi(n,o){}function Wi(n,o){if(n&1&&(z(0,"span")(1,"span"),S(2,"span",4),C()()),n&2){let e=l(2);_("ant-tree-icon__open",e.isSwitcherOpen)("ant-tree-icon__close",e.isSwitcherClose)("ant-tree-icon_loading",e.isLoading)("ant-select-tree-iconEle",e.selectMode)("ant-tree-iconEle",!e.selectMode),h(),_("ant-select-tree-iconEle",e.selectMode)("ant-select-tree-icon__customize",e.selectMode)("ant-tree-iconEle",!e.selectMode)("ant-tree-icon__customize",!e.selectMode),h(),u("nzType",e.icon)}}function Ji(n,o){if(n&1&&(v(0,Wi,3,19,"span",3),S(1,"span",1),St(2,"nzHighlight")),n&2){let e=l();D(e.icon&&e.showIcon?0:-1),h(),u("innerHTML",kt(2,2,e.title,e.matchedValue,"i","font-highlight"),at)}}function qi(n,o){if(n&1&&S(0,"nz-tree-drop-indicator",2),n&2){let e=l();u("dropPosition",e.dragPosition)("level",e.context.level)}}function Yi(n,o){if(n&1){let e=H();z(0,"nz-tree-node-switcher",4),B("click",function(i){w(e);let r=l();return E(r.clickExpand(i))}),C()}if(n&2){let e=l();u("nzShowExpand",e.nzShowExpand)("nzShowLine",e.nzShowLine)("nzExpandedIcon",e.nzExpandedIcon)("nzSelectMode",e.nzSelectMode)("context",e.nzTreeNode)("isLeaf",e.isLeaf)("isExpanded",e.isExpanded)("isLoading",e.isLoading)}}function Xi(n,o){if(n&1){let e=H();z(0,"nz-tree-node-checkbox",5),B("click",function(i){w(e);let r=l();return E(r.clickCheckBox(i))}),C()}if(n&2){let e=l();u("nzSelectMode",e.nzSelectMode)("isChecked",e.isChecked)("isHalfChecked",e.isHalfChecked)("isDisabled",e.isDisabled)("isDisableCheckbox",e.isDisableCheckbox)}}var en=["nzTreeTemplate"],ri=n=>({$implicit:n});function tn(n,o){}function nn(n,o){if(n&1&&(le(0),v(1,tn,0,0,"ng-template",10),de()),n&2){let e=o.$implicit;l(2);let t=he(9);h(),u("ngTemplateOutlet",t)("ngTemplateOutletContext",Ke(2,ri,e))}}function rn(n,o){if(n&1&&(z(0,"cdk-virtual-scroll-viewport",8),v(1,nn,2,4,"ng-container",9),C()),n&2){let e=l();G("height",e.nzVirtualHeight),_("ant-select-tree-list-holder-inner",e.nzSelectMode)("ant-tree-list-holder-inner",!e.nzSelectMode),u("itemSize",e.nzVirtualItemSize)("minBufferPx",e.nzVirtualMinBufferPx)("maxBufferPx",e.nzVirtualMaxBufferPx),h(),u("cdkVirtualForOf",e.nzFlattenNodes)("cdkVirtualForTrackBy",e.trackByFlattenNode)}}function sn(n,o){}function on(n,o){if(n&1&&v(0,sn,0,0,"ng-template",10),n&2){let e=o.$implicit;l(2);let t=he(9);u("ngTemplateOutlet",t)("ngTemplateOutletContext",Ke(2,ri,e))}}function an(n,o){if(n&1&&(z(0,"div",11),q(1,on,1,4,null,10,ht().trackByFlattenNode,!0),C()),n&2){let e=l();_("ant-select-tree-list-holder-inner",e.nzSelectMode)("ant-tree-list-holder-inner",!e.nzSelectMode),u("@.disabled",e.beforeInit||!!(e.noAnimation!=null&&e.noAnimation.nzNoAnimation))("nzNoAnimation",e.noAnimation==null?null:e.noAnimation.nzNoAnimation)("@treeCollapseMotion",e.nzFlattenNodes.length),h(),Y(e.nzFlattenNodes)}}function cn(n,o){if(n&1){let e=H();z(0,"nz-tree-node",12),B("nzExpandChange",function(i){w(e);let r=l();return E(r.eventTriggerChanged(i))})("nzClick",function(i){w(e);let r=l();return E(r.eventTriggerChanged(i))})("nzDblClick",function(i){w(e);let r=l();return E(r.eventTriggerChanged(i))})("nzContextMenu",function(i){w(e);let r=l();return E(r.eventTriggerChanged(i))})("nzCheckBoxChange",function(i){w(e);let r=l();return E(r.eventTriggerChanged(i))})("nzOnDragStart",function(i){w(e);let r=l();return E(r.eventTriggerChanged(i))})("nzOnDragEnter",function(i){w(e);let r=l();return E(r.eventTriggerChanged(i))})("nzOnDragOver",function(i){w(e);let r=l();return E(r.eventTriggerChanged(i))})("nzOnDragLeave",function(i){w(e);let r=l();return E(r.eventTriggerChanged(i))})("nzOnDragEnd",function(i){w(e);let r=l();return E(r.eventTriggerChanged(i))})("nzOnDrop",function(i){w(e);let r=l();return E(r.eventTriggerChanged(i))}),C()}if(n&2){let e=o.$implicit,t=l();u("icon",e.icon)("title",e.title)("isLoading",e.isLoading)("isSelected",e.isSelected)("isDisabled",e.isDisabled)("isMatched",e.isMatched)("isExpanded",e.isExpanded)("isLeaf",e.isLeaf)("isStart",e.isStart)("isEnd",e.isEnd)("isChecked",e.isChecked)("isHalfChecked",e.isHalfChecked)("isDisableCheckbox",e.isDisableCheckbox)("isSelectable",e.isSelectable)("canHide",e.canHide)("nzTreeNode",e)("nzSelectMode",t.nzSelectMode)("nzShowLine",t.nzShowLine)("nzExpandedIcon",t.nzExpandedIcon)("nzDraggable",t.nzDraggable)("nzCheckable",t.nzCheckable)("nzShowExpand",t.nzShowExpand)("nzAsyncData",t.nzAsyncData)("nzSearchValue",t.nzSearchValue)("nzHideUnMatched",t.nzHideUnMatched)("nzBeforeDrop",t.nzBeforeDrop)("nzShowIcon",t.nzShowIcon)("nzTreeTemplate",t.nzTreeTemplate||t.nzTreeTemplateChild)}}var ln=(()=>{class n{constructor(e){this.cdr=e,this.level=1,this.direction="ltr",this.style={}}ngOnChanges(e){this.renderIndicator(this.dropPosition,this.direction)}renderIndicator(e,t="ltr"){let r=t==="ltr"?"left":"right",s=t==="ltr"?"right":"left",a={[r]:"4px",[s]:"0px"};switch(e){case-1:a.top="-3px";break;case 1:a.bottom="-3px";break;case 0:a.bottom="-3px",a[r]="28px";break;default:a.display="none";break}this.style=a,this.cdr.markForCheck()}static{this.\u0275fac=function(t){return new(t||n)(N(U))}}static{this.\u0275cmp=I({type:n,selectors:[["nz-tree-drop-indicator"]],hostVars:4,hostBindings:function(t,i){t&2&&(dt(i.style),_("ant-tree-drop-indicator",!0))},inputs:{dropPosition:"dropPosition",level:[2,"level","level",vt],direction:"direction"},exportAs:["NzTreeDropIndicator"],standalone:!0,features:[V,F,A],decls:0,vars:0,template:function(t,i){},encapsulation:2,changeDetection:0})}}return n})(),dn=(()=>{class n{constructor(){this.nzTreeLevel=0,this.nzIsStart=[],this.nzIsEnd=[],this.nzSelectMode=!1,this.listOfUnit=[]}ngOnChanges(e){let{nzTreeLevel:t}=e;t&&(this.listOfUnit=[...new Array(t.currentValue||0)])}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=I({type:n,selectors:[["nz-tree-indent"]],hostVars:5,hostBindings:function(t,i){t&2&&(me("aria-hidden",!0),_("ant-tree-indent",!i.nzSelectMode)("ant-select-tree-indent",i.nzSelectMode))},inputs:{nzTreeLevel:"nzTreeLevel",nzIsStart:"nzIsStart",nzIsEnd:"nzIsEnd",nzSelectMode:"nzSelectMode"},exportAs:["nzTreeIndent"],standalone:!0,features:[F,A],decls:2,vars:0,consts:[[3,"ant-tree-indent-unit","ant-select-tree-indent-unit","ant-select-tree-indent-unit-start","ant-tree-indent-unit-start","ant-select-tree-indent-unit-end","ant-tree-indent-unit-end"]],template:function(t,i){t&1&&q(0,Pi,1,12,"span",0,pt),t&2&&Y(i.listOfUnit)},encapsulation:2,changeDetection:0})}}return n})(),hn=(()=>{class n{constructor(){this.nzSelectMode=!1}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=I({type:n,selectors:[["nz-tree-node-checkbox","builtin",""]],hostVars:16,hostBindings:function(t,i){t&2&&_("ant-select-tree-checkbox",i.nzSelectMode)("ant-select-tree-checkbox-checked",i.nzSelectMode&&i.isChecked)("ant-select-tree-checkbox-indeterminate",i.nzSelectMode&&i.isHalfChecked)("ant-select-tree-checkbox-disabled",i.nzSelectMode&&(i.isDisabled||i.isDisableCheckbox))("ant-tree-checkbox",!i.nzSelectMode)("ant-tree-checkbox-checked",!i.nzSelectMode&&i.isChecked)("ant-tree-checkbox-indeterminate",!i.nzSelectMode&&i.isHalfChecked)("ant-tree-checkbox-disabled",!i.nzSelectMode&&(i.isDisabled||i.isDisableCheckbox))},inputs:{nzSelectMode:"nzSelectMode",isChecked:[2,"isChecked","isChecked",c],isHalfChecked:[2,"isHalfChecked","isHalfChecked",c],isDisabled:[2,"isDisabled","isDisabled",c],isDisableCheckbox:[2,"isDisableCheckbox","isDisableCheckbox",c]},standalone:!0,features:[V,A],attrs:ni,decls:1,vars:4,template:function(t,i){t&1&&S(0,"span"),t&2&&_("ant-tree-checkbox-inner",!i.nzSelectMode)("ant-select-tree-checkbox-inner",i.nzSelectMode)},encapsulation:2,changeDetection:0})}}return n})(),si=(()=>{class n{constructor(){this.nzSelectMode=!1}get isShowLineIcon(){return!this.isLeaf&&!!this.nzShowLine}get isShowSwitchIcon(){return!this.isLeaf&&!this.nzShowLine}get isSwitcherOpen(){return!!this.isExpanded&&!this.isLeaf}get isSwitcherClose(){return!this.isExpanded&&!this.isLeaf}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=I({type:n,selectors:[["nz-tree-node-switcher"]],hostVars:16,hostBindings:function(t,i){t&2&&_("ant-select-tree-switcher",i.nzSelectMode)("ant-select-tree-switcher-noop",i.nzSelectMode&&i.isLeaf)("ant-select-tree-switcher_open",i.nzSelectMode&&i.isSwitcherOpen)("ant-select-tree-switcher_close",i.nzSelectMode&&i.isSwitcherClose)("ant-tree-switcher",!i.nzSelectMode)("ant-tree-switcher-noop",!i.nzSelectMode&&i.isLeaf)("ant-tree-switcher_open",!i.nzSelectMode&&i.isSwitcherOpen)("ant-tree-switcher_close",!i.nzSelectMode&&i.isSwitcherClose)},inputs:{nzShowExpand:[2,"nzShowExpand","nzShowExpand",c],nzShowLine:[2,"nzShowLine","nzShowLine",c],nzExpandedIcon:"nzExpandedIcon",nzSelectMode:"nzSelectMode",context:"context",isLeaf:[2,"isLeaf","isLeaf",c],isLoading:[2,"isLoading","isLoading",c],isExpanded:[2,"isExpanded","isExpanded",c]},standalone:!0,features:[V,A],decls:2,vars:2,consts:[["nz-icon","","nzType","loading",1,"ant-tree-switcher-loading-icon",3,"nzSpin"],[4,"nzStringTemplateOutlet","nzStringTemplateOutletContext"],["nz-icon","","nzType","caret-down"],["nz-icon","",1,"ant-tree-switcher-line-icon",3,"nzType"],["nz-icon","","nzType","file",1,"ant-tree-switcher-line-icon"]],template:function(t,i){t&1&&v(0,Hi,2,1)(1,$i,2,1),t&2&&(D(i.isShowSwitchIcon?0:-1),h(),D(i.nzShowLine?1:-1))},dependencies:[re,ne,Le,Ae],encapsulation:2,changeDetection:0})}}return n})(),oi=(()=>{class n{get canDraggable(){return this.draggable&&!this.isDisabled?!0:null}get matchedValue(){return this.isMatched?this.searchValue:""}get isSwitcherOpen(){return this.isExpanded&&!this.isLeaf}get isSwitcherClose(){return!this.isExpanded&&!this.isLeaf}constructor(e){this.cdr=e,this.treeTemplate=null,this.selectMode=!1,this.showIndicator=!0}ngOnChanges(e){let{showIndicator:t,dragPosition:i}=e;(t||i)&&this.cdr.markForCheck()}static{this.\u0275fac=function(t){return new(t||n)(N(U))}}static{this.\u0275cmp=I({type:n,selectors:[["nz-tree-node-title"]],hostVars:21,hostBindings:function(t,i){t&2&&(me("title",i.title)("draggable",i.canDraggable)("aria-grabbed",i.canDraggable),_("draggable",i.canDraggable)("ant-select-tree-node-content-wrapper",i.selectMode)("ant-select-tree-node-content-wrapper-open",i.selectMode&&i.isSwitcherOpen)("ant-select-tree-node-content-wrapper-close",i.selectMode&&i.isSwitcherClose)("ant-select-tree-node-selected",i.selectMode&&i.isSelected)("ant-tree-node-content-wrapper",!i.selectMode)("ant-tree-node-content-wrapper-open",!i.selectMode&&i.isSwitcherOpen)("ant-tree-node-content-wrapper-close",!i.selectMode&&i.isSwitcherClose)("ant-tree-node-selected",!i.selectMode&&i.isSelected))},inputs:{searchValue:"searchValue",treeTemplate:"treeTemplate",draggable:[2,"draggable","draggable",c],showIcon:[2,"showIcon","showIcon",c],selectMode:"selectMode",context:"context",icon:"icon",title:"title",isLoading:[2,"isLoading","isLoading",c],isSelected:[2,"isSelected","isSelected",c],isDisabled:[2,"isDisabled","isDisabled",c],isMatched:[2,"isMatched","isMatched",c],isExpanded:[2,"isExpanded","isExpanded",c],isLeaf:[2,"isLeaf","isLeaf",c],showIndicator:"showIndicator",dragPosition:"dragPosition"},standalone:!0,features:[V,F,A],decls:3,vars:7,consts:[[3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"ant-tree-title",3,"innerHTML"],[3,"dropPosition","level"],[3,"ant-tree-icon__open","ant-tree-icon__close","ant-tree-icon_loading","ant-select-tree-iconEle","ant-tree-iconEle"],["nz-icon","",3,"nzType"]],template:function(t,i){t&1&&v(0,Zi,0,0,"ng-template",0)(1,Ji,3,7,"span",1)(2,qi,1,2,"nz-tree-drop-indicator",2),t&2&&(u("ngTemplateOutlet",i.treeTemplate)("ngTemplateOutletContext",be(4,Ze,i.context,i.context.origin)),h(),D(i.treeTemplate?-1:1),h(),D(i.showIndicator?2:-1))},dependencies:[Ge,re,ne,Xt,Yt,ln],encapsulation:2,changeDetection:0})}}return n})(),ai=(()=>{class n{get displayStyle(){return this.nzSearchValue&&this.nzHideUnMatched&&!this.isMatched&&!this.isExpanded&&this.canHide?"none":""}get isSwitcherOpen(){return this.isExpanded&&!this.isLeaf}get isSwitcherClose(){return!this.isExpanded&&!this.isLeaf}clickExpand(e){e.preventDefault(),!this.isLoading&&!this.isLeaf&&(this.nzAsyncData&&this.nzTreeNode.children.length===0&&!this.isExpanded&&(this.nzTreeNode.isLoading=!0),this.nzTreeNode.setExpanded(!this.isExpanded)),this.nzTreeService.setExpandedNodeList(this.nzTreeNode);let t=this.nzTreeService.formatEvent("expand",this.nzTreeNode,e);this.nzExpandChange.emit(t)}clickSelect(e){e.preventDefault(),this.isSelectable&&!this.isDisabled&&(this.nzTreeNode.isSelected=!this.nzTreeNode.isSelected),this.nzTreeService.setSelectedNodeList(this.nzTreeNode);let t=this.nzTreeService.formatEvent("click",this.nzTreeNode,e);this.nzClick.emit(t)}dblClick(e){e.preventDefault();let t=this.nzTreeService.formatEvent("dblclick",this.nzTreeNode,e);this.nzDblClick.emit(t)}contextMenu(e){e.preventDefault();let t=this.nzTreeService.formatEvent("contextmenu",this.nzTreeNode,e);this.nzContextMenu.emit(t)}clickCheckBox(e){if(e.preventDefault(),this.isDisabled||this.isDisableCheckbox)return;this.nzTreeNode.isChecked=!this.nzTreeNode.isChecked,this.nzTreeNode.isHalfChecked=!1,this.nzTreeService.setCheckedNodeList(this.nzTreeNode);let t=this.nzTreeService.formatEvent("check",this.nzTreeNode,e);this.nzCheckBoxChange.emit(t)}clearDragClass(){["drag-over-gap-top","drag-over-gap-bottom","drag-over","drop-target"].forEach(t=>{this.renderer.removeClass(this.elementRef.nativeElement,t)})}handleDragStart(e){try{e.dataTransfer.setData("text/plain",this.nzTreeNode.key)}catch{}this.nzTreeService.setSelectedNode(this.nzTreeNode),this.draggingKey=this.nzTreeNode.key;let t=this.nzTreeService.formatEvent("dragstart",this.nzTreeNode,e);this.nzOnDragStart.emit(t)}handleDragEnter(e){e.preventDefault(),this.showIndicator=this.nzTreeNode.key!==this.nzTreeService.getSelectedNode()?.key,this.renderIndicator(2),this.ngZone.run(()=>{let t=this.nzTreeService.formatEvent("dragenter",this.nzTreeNode,e);this.nzOnDragEnter.emit(t)})}handleDragOver(e){e.preventDefault();let t=this.nzTreeService.calcDropPosition(e);this.dragPos!==t&&(this.clearDragClass(),this.renderIndicator(t),this.dragPos===0&&this.isLeaf||(this.renderer.addClass(this.elementRef.nativeElement,this.dragPosClass[this.dragPos]),this.renderer.addClass(this.elementRef.nativeElement,"drop-target")));let i=this.nzTreeService.formatEvent("dragover",this.nzTreeNode,e);this.nzOnDragOver.emit(i)}handleDragLeave(e){e.preventDefault(),this.renderIndicator(2),this.clearDragClass();let t=this.nzTreeService.formatEvent("dragleave",this.nzTreeNode,e);this.nzOnDragLeave.emit(t)}handleDragDrop(e){e.preventDefault(),e.stopPropagation(),this.ngZone.run(()=>{this.showIndicator=!1,this.clearDragClass();let t=this.nzTreeService.getSelectedNode();if(!t||t&&t.key===this.nzTreeNode.key||this.dragPos===0&&this.isLeaf)return;let i=this.nzTreeService.formatEvent("drop",this.nzTreeNode,e),r=this.nzTreeService.formatEvent("dragend",this.nzTreeNode,e);this.nzBeforeDrop?this.nzBeforeDrop({dragNode:this.nzTreeService.getSelectedNode(),node:this.nzTreeNode,pos:this.dragPos}).subscribe(s=>{s&&this.nzTreeService.dropAndApply(this.nzTreeNode,this.dragPos),this.nzOnDrop.emit(i),this.nzOnDragEnd.emit(r)}):this.nzTreeNode&&(this.nzTreeService.dropAndApply(this.nzTreeNode,this.dragPos),this.nzOnDrop.emit(i))})}handleDragEnd(e){e.preventDefault(),this.ngZone.run(()=>{if(this.nzBeforeDrop)this.draggingKey=null,this.markForCheck();else{this.draggingKey=null;let t=this.nzTreeService.formatEvent("dragend",this.nzTreeNode,e);this.nzOnDragEnd.emit(t)}})}handDragEvent(){this.ngZone.runOutsideAngular(()=>{if(this.nzDraggable){let e=this.elementRef.nativeElement;this.destroy$=new $,P(e,"dragstart").pipe(b(this.destroy$)).subscribe(t=>this.handleDragStart(t)),P(e,"dragenter").pipe(b(this.destroy$)).subscribe(t=>this.handleDragEnter(t)),P(e,"dragover").pipe(b(this.destroy$)).subscribe(t=>this.handleDragOver(t)),P(e,"dragleave").pipe(b(this.destroy$)).subscribe(t=>this.handleDragLeave(t)),P(e,"drop").pipe(b(this.destroy$)).subscribe(t=>this.handleDragDrop(t)),P(e,"dragend").pipe(b(this.destroy$)).subscribe(t=>this.handleDragEnd(t))}else this.destroy$.next(!0),this.destroy$.complete()})}markForCheck(){this.cdr.markForCheck()}constructor(e,t,i,r,s){this.nzTreeService=e,this.ngZone=t,this.renderer=i,this.elementRef=r,this.cdr=s,this.icon="",this.title="",this.isLoading=!1,this.isSelected=!1,this.isDisabled=!1,this.isMatched=!1,this.isStart=[],this.isEnd=[],this.nzHideUnMatched=!1,this.nzNoAnimation=!1,this.nzSelectMode=!1,this.nzShowIcon=!1,this.nzTreeTemplate=null,this.nzSearchValue="",this.nzDraggable=!1,this.nzClick=new f,this.nzDblClick=new f,this.nzContextMenu=new f,this.nzCheckBoxChange=new f,this.nzExpandChange=new f,this.nzOnDragStart=new f,this.nzOnDragEnter=new f,this.nzOnDragOver=new f,this.nzOnDragLeave=new f,this.nzOnDrop=new f,this.nzOnDragEnd=new f,this.destroy$=new $,this.dragPos=2,this.dragPosClass={0:"drag-over",1:"drag-over-gap-bottom","-1":"drag-over-gap-top"},this.draggingKey=null,this.showIndicator=!1,this.noAnimation=J(Oe,{host:!0,optional:!0})}ngOnInit(){this.nzTreeNode.component=this,this.ngZone.runOutsideAngular(()=>{P(this.elementRef.nativeElement,"mousedown").pipe(b(this.destroy$)).subscribe(e=>{this.nzSelectMode&&e.preventDefault()})})}ngOnChanges(e){let{nzDraggable:t}=e;t&&this.handDragEvent()}ngOnDestroy(){this.destroy$.next(!0),this.destroy$.complete()}renderIndicator(e){this.ngZone.run(()=>{this.showIndicator=e!==2,!(this.nzTreeNode.key===this.nzTreeService.getSelectedNode()?.key||e===0&&this.isLeaf)&&(this.dragPos=e,this.cdr.markForCheck())})}static{this.\u0275fac=function(t){return new(t||n)(N(ge),N(Te),N(ct),N(we),N(U))}}static{this.\u0275cmp=I({type:n,selectors:[["nz-tree-node","builtin",""]],hostVars:36,hostBindings:function(t,i){t&2&&(G("display",i.displayStyle),_("ant-select-tree-treenode",i.nzSelectMode)("ant-select-tree-treenode-disabled",i.nzSelectMode&&i.isDisabled)("ant-select-tree-treenode-switcher-open",i.nzSelectMode&&i.isSwitcherOpen)("ant-select-tree-treenode-switcher-close",i.nzSelectMode&&i.isSwitcherClose)("ant-select-tree-treenode-checkbox-checked",i.nzSelectMode&&i.isChecked)("ant-select-tree-treenode-checkbox-indeterminate",i.nzSelectMode&&i.isHalfChecked)("ant-select-tree-treenode-selected",i.nzSelectMode&&i.isSelected)("ant-select-tree-treenode-loading",i.nzSelectMode&&i.isLoading)("ant-tree-treenode",!i.nzSelectMode)("ant-tree-treenode-disabled",!i.nzSelectMode&&i.isDisabled)("ant-tree-treenode-switcher-open",!i.nzSelectMode&&i.isSwitcherOpen)("ant-tree-treenode-switcher-close",!i.nzSelectMode&&i.isSwitcherClose)("ant-tree-treenode-checkbox-checked",!i.nzSelectMode&&i.isChecked)("ant-tree-treenode-checkbox-indeterminate",!i.nzSelectMode&&i.isHalfChecked)("ant-tree-treenode-selected",!i.nzSelectMode&&i.isSelected)("ant-tree-treenode-loading",!i.nzSelectMode&&i.isLoading)("dragging",i.draggingKey===i.nzTreeNode.key))},inputs:{icon:"icon",title:"title",isLoading:[2,"isLoading","isLoading",c],isSelected:[2,"isSelected","isSelected",c],isDisabled:[2,"isDisabled","isDisabled",c],isMatched:[2,"isMatched","isMatched",c],isExpanded:[2,"isExpanded","isExpanded",c],isLeaf:[2,"isLeaf","isLeaf",c],isChecked:[2,"isChecked","isChecked",c],isHalfChecked:[2,"isHalfChecked","isHalfChecked",c],isDisableCheckbox:[2,"isDisableCheckbox","isDisableCheckbox",c],isSelectable:[2,"isSelectable","isSelectable",c],canHide:[2,"canHide","canHide",c],isStart:"isStart",isEnd:"isEnd",nzTreeNode:"nzTreeNode",nzShowLine:[2,"nzShowLine","nzShowLine",c],nzShowExpand:[2,"nzShowExpand","nzShowExpand",c],nzCheckable:[2,"nzCheckable","nzCheckable",c],nzAsyncData:[2,"nzAsyncData","nzAsyncData",c],nzHideUnMatched:[2,"nzHideUnMatched","nzHideUnMatched",c],nzNoAnimation:[2,"nzNoAnimation","nzNoAnimation",c],nzSelectMode:[2,"nzSelectMode","nzSelectMode",c],nzShowIcon:[2,"nzShowIcon","nzShowIcon",c],nzExpandedIcon:"nzExpandedIcon",nzTreeTemplate:"nzTreeTemplate",nzBeforeDrop:"nzBeforeDrop",nzSearchValue:"nzSearchValue",nzDraggable:[2,"nzDraggable","nzDraggable",c]},outputs:{nzClick:"nzClick",nzDblClick:"nzDblClick",nzContextMenu:"nzContextMenu",nzCheckBoxChange:"nzCheckBoxChange",nzExpandChange:"nzExpandChange",nzOnDragStart:"nzOnDragStart",nzOnDragEnter:"nzOnDragEnter",nzOnDragOver:"nzOnDragOver",nzOnDragLeave:"nzOnDragLeave",nzOnDrop:"nzOnDrop",nzOnDragEnd:"nzOnDragEnd"},exportAs:["nzTreeBuiltinNode"],standalone:!0,features:[V,F,A],attrs:ni,decls:4,vars:22,consts:[[3,"nzTreeLevel","nzSelectMode","nzIsStart","nzIsEnd"],[3,"nzShowExpand","nzShowLine","nzExpandedIcon","nzSelectMode","context","isLeaf","isExpanded","isLoading"],["builtin","",3,"nzSelectMode","isChecked","isHalfChecked","isDisabled","isDisableCheckbox"],[3,"dblclick","click","contextmenu","icon","title","isLoading","isSelected","isDisabled","isMatched","isExpanded","isLeaf","searchValue","treeTemplate","draggable","showIcon","selectMode","context","showIndicator","dragPosition"],[3,"click","nzShowExpand","nzShowLine","nzExpandedIcon","nzSelectMode","context","isLeaf","isExpanded","isLoading"],["builtin","",3,"click","nzSelectMode","isChecked","isHalfChecked","isDisabled","isDisableCheckbox"]],template:function(t,i){t&1&&(S(0,"nz-tree-indent",0),v(1,Yi,1,8,"nz-tree-node-switcher",1)(2,Xi,1,5,"nz-tree-node-checkbox",2),z(3,"nz-tree-node-title",3),B("dblclick",function(s){return i.dblClick(s)})("click",function(s){return i.clickSelect(s)})("contextmenu",function(s){return i.contextMenu(s)}),C()),t&2&&(u("nzTreeLevel",i.nzTreeNode.level)("nzSelectMode",i.nzSelectMode)("nzIsStart",i.isStart)("nzIsEnd",i.isEnd),h(),D(i.nzShowExpand?1:-1),h(),D(i.nzCheckable?2:-1),h(),u("icon",i.icon)("title",i.title)("isLoading",i.isLoading)("isSelected",i.isSelected)("isDisabled",i.isDisabled)("isMatched",i.isMatched)("isExpanded",i.isExpanded)("isLeaf",i.isLeaf)("searchValue",i.nzSearchValue)("treeTemplate",i.nzTreeTemplate)("draggable",i.nzDraggable)("showIcon",i.nzShowIcon)("selectMode",i.nzSelectMode)("context",i.nzTreeNode)("showIndicator",i.showIndicator)("dragPosition",i.dragPos))},dependencies:[dn,si,hn,oi],encapsulation:2,changeDetection:0})}}return n})(),ci=(()=>{class n extends ge{constructor(){super()}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=L({token:n,factory:n.\u0275fac})}}return n})();function pn(){let n=J(ti,{skipSelf:!0,optional:!0}),o=J(ci);return n??o}var un="tree",We=(()=>{class n extends Re{writeValue(e){this.handleNzData(e)}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}renderTreeProperties(e){let t=!1,i=!1,{nzData:r,nzExpandedKeys:s,nzSelectedKeys:a,nzCheckedKeys:p,nzCheckStrictly:k,nzExpandAll:T,nzMultiple:y,nzSearchValue:x}=e;T&&(t=!0,i=this.nzExpandAll),y&&(this.nzTreeService.isMultiple=this.nzMultiple),k&&(this.nzTreeService.isCheckStrictly=this.nzCheckStrictly),r&&this.handleNzData(this.nzData),p&&this.handleCheckedKeys(this.nzCheckedKeys),k&&this.handleCheckedKeys(null),(s||T)&&(t=!0,this.handleExpandedKeys(i||this.nzExpandedKeys)),a&&this.handleSelectedKeys(this.nzSelectedKeys,this.nzMultiple),x&&(x.firstChange&&!this.nzSearchValue||(t=!1,this.handleSearchValue(x.currentValue,this.nzSearchFunc),this.nzSearchValueChange.emit(this.nzTreeService.formatEvent("search",null,null))));let O=this.getExpandedNodeList().map(wi=>wi.key),ve=t?i||this.nzExpandedKeys:O;this.handleFlattenNodes(this.nzTreeService.rootNodes,ve)}trackByFlattenNode(e,t){return t.key}handleNzData(e){if(Array.isArray(e)){let t=this.coerceTreeNodes(e);this.nzTreeService.initTree(t)}}handleFlattenNodes(e,t=[]){this.nzTreeService.flattenTreeData(e,t)}handleCheckedKeys(e){this.nzTreeService.conductCheck(e,this.nzCheckStrictly)}handleExpandedKeys(e=[]){this.nzTreeService.conductExpandedKeys(e)}handleSelectedKeys(e,t){this.nzTreeService.conductSelectedKeys(e,t)}handleSearchValue(e,t){let i=$e(this.nzTreeService.rootNodes,!0).map(s=>s.data),r=s=>t?t(s.origin):!(!e||!s.title.toLowerCase().includes(e.toLowerCase()));i.forEach(s=>{s.isMatched=r(s),s.canHide=!s.isMatched,s.isMatched?this.nzTreeService.expandNodeAllParentBySearch(s):(s.setExpanded(!1),this.nzTreeService.setExpandedNodeList(s)),this.nzTreeService.setMatchedNodeList(s)})}eventTriggerChanged(e){let t=e.node;switch(e.eventName){case"expand":this.renderTree(),this.nzExpandChange.emit(e);break;case"click":this.nzClick.emit(e);break;case"dblclick":this.nzDblClick.emit(e);break;case"contextmenu":this.nzContextMenu.emit(e);break;case"check":this.nzTreeService.setCheckedNodeList(t),this.nzCheckStrictly||this.nzTreeService.conduct(t);let i=this.nzTreeService.formatEvent("check",t,e.event);this.nzCheckBoxChange.emit(i);let r=this.nzTreeService.getCheckedNodeKeys();this.nzCheckedKeysChange.emit(r);break;case"dragstart":t.isExpanded&&(t.setExpanded(!t.isExpanded),this.renderTree()),this.nzOnDragStart.emit(e);break;case"dragenter":let s=this.nzTreeService.getSelectedNode();s&&s.key!==t.key&&!t.isExpanded&&!t.isLeaf&&(t.setExpanded(!0),this.renderTree()),this.nzOnDragEnter.emit(e);break;case"dragover":this.nzOnDragOver.emit(e);break;case"dragleave":this.nzOnDragLeave.emit(e);break;case"dragend":this.nzOnDragEnd.emit(e);break;case"drop":this.renderTree(),this.nzOnDrop.emit(e);break}}renderTree(){this.handleFlattenNodes(this.nzTreeService.rootNodes,this.getExpandedNodeList().map(e=>e.key)),this.cdr.markForCheck()}constructor(e,t,i,r){super(e),this.nzConfigService=t,this.cdr=i,this.directionality=r,this._nzModuleName=un,this.nzShowIcon=!1,this.nzHideUnMatched=!1,this.nzBlockNode=!1,this.nzExpandAll=!1,this.nzSelectMode=!1,this.nzCheckStrictly=!1,this.nzShowExpand=!0,this.nzShowLine=!1,this.nzCheckable=!1,this.nzAsyncData=!1,this.nzDraggable=!1,this.nzMultiple=!1,this.nzVirtualItemSize=28,this.nzVirtualMaxBufferPx=500,this.nzVirtualMinBufferPx=28,this.nzVirtualHeight=null,this.nzData=[],this.nzExpandedKeys=[],this.nzSelectedKeys=[],this.nzCheckedKeys=[],this.nzSearchValue="",this.nzFlattenNodes=[],this.beforeInit=!0,this.dir="ltr",this.nzExpandedKeysChange=new f,this.nzSelectedKeysChange=new f,this.nzCheckedKeysChange=new f,this.nzSearchValueChange=new f,this.nzClick=new f,this.nzDblClick=new f,this.nzContextMenu=new f,this.nzCheckBoxChange=new f,this.nzExpandChange=new f,this.nzOnDragStart=new f,this.nzOnDragEnter=new f,this.nzOnDragOver=new f,this.nzOnDragLeave=new f,this.nzOnDrop=new f,this.nzOnDragEnd=new f,this.HIDDEN_STYLE={width:0,height:0,display:"flex",overflow:"hidden",opacity:0,border:0,padding:0,margin:0},this.HIDDEN_NODE_STYLE={position:"absolute",pointerEvents:"none",visibility:"hidden",height:0,overflow:"hidden"},this.destroy$=new $,this.onChange=()=>null,this.onTouched=()=>null,this.noAnimation=J(Oe,{host:!0,optional:!0})}ngOnInit(){this.nzTreeService.flattenNodes$.pipe(b(this.destroy$)).subscribe(e=>{this.nzFlattenNodes=this.nzVirtualHeight&&this.nzHideUnMatched&&this.nzSearchValue?.length>0?e.filter(t=>!t.canHide):e,this.cdr.markForCheck()}),this.dir=this.directionality.value,this.directionality.change?.pipe(b(this.destroy$)).subscribe(e=>{this.dir=e,this.cdr.detectChanges()})}ngOnChanges(e){this.renderTreeProperties(e)}ngAfterViewInit(){this.beforeInit=!1}ngOnDestroy(){this.destroy$.next(!0),this.destroy$.complete()}static{this.\u0275fac=function(t){return new(t||n)(N(ge),N(ue),N(U),N(Se))}}static{this.\u0275cmp=I({type:n,selectors:[["nz-tree"]],contentQueries:function(t,i,r){if(t&1&&mt(r,en,7),t&2){let s;X(s=ee())&&(i.nzTreeTemplateChild=s.first)}},viewQuery:function(t,i){if(t&1&&ie(Be,5,Be),t&2){let r;X(r=ee())&&(i.cdkVirtualScrollViewport=r.first)}},hostVars:20,hostBindings:function(t,i){t&2&&_("ant-select-tree",i.nzSelectMode)("ant-select-tree-show-line",i.nzSelectMode&&i.nzShowLine)("ant-select-tree-icon-hide",i.nzSelectMode&&!i.nzShowIcon)("ant-select-tree-block-node",i.nzSelectMode&&i.nzBlockNode)("ant-tree",!i.nzSelectMode)("ant-tree-rtl",i.dir==="rtl")("ant-tree-show-line",!i.nzSelectMode&&i.nzShowLine)("ant-tree-icon-hide",!i.nzSelectMode&&!i.nzShowIcon)("ant-tree-block-node",!i.nzSelectMode&&i.nzBlockNode)("draggable-tree",i.nzDraggable)},inputs:{nzShowIcon:[2,"nzShowIcon","nzShowIcon",c],nzHideUnMatched:[2,"nzHideUnMatched","nzHideUnMatched",c],nzBlockNode:[2,"nzBlockNode","nzBlockNode",c],nzExpandAll:[2,"nzExpandAll","nzExpandAll",c],nzSelectMode:[2,"nzSelectMode","nzSelectMode",c],nzCheckStrictly:[2,"nzCheckStrictly","nzCheckStrictly",c],nzShowExpand:[2,"nzShowExpand","nzShowExpand",c],nzShowLine:[2,"nzShowLine","nzShowLine",c],nzCheckable:[2,"nzCheckable","nzCheckable",c],nzAsyncData:[2,"nzAsyncData","nzAsyncData",c],nzDraggable:[2,"nzDraggable","nzDraggable",c],nzMultiple:[2,"nzMultiple","nzMultiple",c],nzExpandedIcon:"nzExpandedIcon",nzVirtualItemSize:"nzVirtualItemSize",nzVirtualMaxBufferPx:"nzVirtualMaxBufferPx",nzVirtualMinBufferPx:"nzVirtualMinBufferPx",nzVirtualHeight:"nzVirtualHeight",nzTreeTemplate:"nzTreeTemplate",nzBeforeDrop:"nzBeforeDrop",nzData:"nzData",nzExpandedKeys:"nzExpandedKeys",nzSelectedKeys:"nzSelectedKeys",nzCheckedKeys:"nzCheckedKeys",nzSearchValue:"nzSearchValue",nzSearchFunc:"nzSearchFunc"},outputs:{nzExpandedKeysChange:"nzExpandedKeysChange",nzSelectedKeysChange:"nzSelectedKeysChange",nzCheckedKeysChange:"nzCheckedKeysChange",nzSearchValueChange:"nzSearchValueChange",nzClick:"nzClick",nzDblClick:"nzDblClick",nzContextMenu:"nzContextMenu",nzCheckBoxChange:"nzCheckBoxChange",nzExpandChange:"nzExpandChange",nzOnDragStart:"nzOnDragStart",nzOnDragEnter:"nzOnDragEnter",nzOnDragOver:"nzOnDragOver",nzOnDragLeave:"nzOnDragLeave",nzOnDrop:"nzOnDrop",nzOnDragEnd:"nzOnDragEnd"},exportAs:["nzTree"],standalone:!0,features:[Me([ci,{provide:ge,useFactory:pn},{provide:xt,useExisting:rt(()=>n),multi:!0}]),V,lt,F,A],decls:10,vars:5,consts:[["nodeTemplate",""],[3,"ngStyle"],[1,"ant-tree-treenode",3,"ngStyle"],[1,"ant-tree-indent"],[1,"ant-tree-indent-unit"],[1,"ant-tree-list",2,"position","relative"],[3,"ant-select-tree-list-holder-inner","ant-tree-list-holder-inner","itemSize","minBufferPx","maxBufferPx","height"],[3,"ant-select-tree-list-holder-inner","ant-tree-list-holder-inner","nzNoAnimation"],[3,"itemSize","minBufferPx","maxBufferPx"],[4,"cdkVirtualFor","cdkVirtualForOf","cdkVirtualForTrackBy"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"nzNoAnimation"],["builtin","",3,"nzExpandChange","nzClick","nzDblClick","nzContextMenu","nzCheckBoxChange","nzOnDragStart","nzOnDragEnter","nzOnDragOver","nzOnDragLeave","nzOnDragEnd","nzOnDrop","icon","title","isLoading","isSelected","isDisabled","isMatched","isExpanded","isLeaf","isStart","isEnd","isChecked","isHalfChecked","isDisableCheckbox","isSelectable","canHide","nzTreeNode","nzSelectMode","nzShowLine","nzExpandedIcon","nzDraggable","nzCheckable","nzShowExpand","nzAsyncData","nzSearchValue","nzHideUnMatched","nzBeforeDrop","nzShowIcon","nzTreeTemplate"]],template:function(t,i){t&1&&(z(0,"div"),S(1,"input",1),C(),z(2,"div",2)(3,"div",3),S(4,"div",4),C()(),z(5,"div",5),v(6,rn,2,11,"cdk-virtual-scroll-viewport",6)(7,an,3,7,"div",7),C(),v(8,cn,1,28,"ng-template",null,0,ze)),t&2&&(h(),u("ngStyle",i.HIDDEN_STYLE),h(),u("ngStyle",i.HIDDEN_NODE_STYLE),h(3),_("ant-select-tree-list",i.nzSelectMode),h(),D(i.nzVirtualHeight?6:7))},dependencies:[Ie,Be,Et,Dt,Ge,Oe,ai],encapsulation:2,data:{animation:[Lt]},changeDetection:0})}}return Z([W()],n.prototype,"nzShowIcon",void 0),Z([W()],n.prototype,"nzHideUnMatched",void 0),Z([W()],n.prototype,"nzBlockNode",void 0),n})(),li=(()=>{class n{static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275mod=K({type:n})}static{this.\u0275inj=j({imports:[We,ai,si,oi]})}}return n})();function mn(n,o){if(n&1&&(le(0),pe(1),de()),n&2){let e=l(2);h(),ft(e.nzText)}}function fn(n,o){if(n&1&&(z(0,"span",0),v(1,mn,2,1,"ng-container",1),C()),n&2){let e=l();h(),u("nzStringTemplateOutlet",e.nzText)}}var zn=(()=>{class n{constructor(){this.nzType="horizontal",this.nzOrientation="center",this.nzDashed=!1,this.nzPlain=!1}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=I({type:n,selectors:[["nz-divider"]],hostAttrs:[1,"ant-divider"],hostVars:16,hostBindings:function(t,i){t&2&&_("ant-divider-horizontal",i.nzType==="horizontal")("ant-divider-vertical",i.nzType==="vertical")("ant-divider-with-text",i.nzText)("ant-divider-plain",i.nzPlain)("ant-divider-with-text-left",i.nzText&&i.nzOrientation==="left")("ant-divider-with-text-right",i.nzText&&i.nzOrientation==="right")("ant-divider-with-text-center",i.nzText&&i.nzOrientation==="center")("ant-divider-dashed",i.nzDashed)},inputs:{nzText:"nzText",nzType:"nzType",nzOrientation:"nzOrientation",nzDashed:[2,"nzDashed","nzDashed",c],nzPlain:[2,"nzPlain","nzPlain",c]},exportAs:["nzDivider"],standalone:!0,features:[V,A],decls:1,vars:1,consts:[[1,"ant-divider-inner-text"],[4,"nzStringTemplateOutlet"]],template:function(t,i){t&1&&v(0,fn,2,1,"span",0),t&2&&D(i.nzText?0:-1)},dependencies:[Le,Ae],encapsulation:2,changeDetection:0})}}return n})(),Lr=(()=>{class n{static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275mod=K({type:n})}static{this.\u0275inj=j({imports:[zn]})}}return n})();var ae=(()=>{class n{static{this.Market="market"}static{this.Blueprint="blueprint"}}return n})(),ce=(()=>{class n{static{this.MarketGroup="marketGroup"}static{this.Type="type"}}return n})();function di(n){return new m(o=>{setTimeout(()=>g(this,null,function*(){if(n.isInit){o.next(),o.complete();return}for(;!n.isInit;)yield d(Ve.wait(10));o.next(),o.complete()}))})}var hi=(()=>{class n{constructor(e,t){this.indexedDBManager=e,this.httpClient=t,this.marketGroupDict={},this.isInit=!1,this.init().subscribe(()=>{console.log("MarketGroupRepositoryService.init DONE")})}waitUntilInit(){return di(this)}init(){return new m(e=>{setTimeout(()=>g(this,null,function*(){if(this.isInit){e.next(),e.complete();return}this.marketGroupDict=yield d(this.httpClient.get("/assets/marketGroups.gen.json")),this.isInit=!0,e.next(),e.complete()}))})}getMarketGroups(){return new m(e=>{setTimeout(()=>g(this,null,function*(){let t=yield d(this.indexedDBManager.getMarketGroupStore()),i=[];t.getAll().onsuccess=r=>{i=r.target.result,e.next(i),e.complete()}}))})}getMarketGroupDict(){return new m(e=>{setTimeout(()=>g(this,null,function*(){yield d(this.waitUntilInit()),e.next(this.marketGroupDict),e.complete()}))})}getMarketGroupDictByIds(e){return new m(t=>{setTimeout(()=>g(this,null,function*(){let i=yield d(this.getMarketGroupDict()),r={};for(let s=0;s<e.length;s++){let a=e[s];i[a]&&(r[a]=i[a])}t.next(r),t.complete()}))})}getMarketGroupDictByChildren(e){return new m(t=>{setTimeout(()=>g(this,null,function*(){let i=new Set;for(let r in e){let s=e[r];s.parentGroupID&&i.add(s.parentGroupID)}if(i.size>0){let r=yield d(this.getMarketGroupDictByIds([...i])),s=yield d(this.getMarketGroupDictByChildren(r));for(let a in s)e[a]=s[a]}t.next(e),t.complete()}))})}static{this.\u0275fac=function(t){return new(t||n)(M(Gt),M(te))}}static{this.\u0275prov=L({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var pi=(()=>{class n{constructor(){this.marketGroupOptions=new se,this.bluePrintMarketGroupOptions=new se}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=L({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var ui=(()=>{class n{constructor(e){this.httpClient=e,this.typeDictOv=new se,this.init().subscribe(()=>{console.log("TypeRepositoryService.init DONE")})}init(){return new m(e=>{setTimeout(()=>g(this,null,function*(){let t=yield d(this.httpClient.get("/assets/types.gen.json"));this.typeDictOv.setValue(t),e.next(),e.complete()}))})}getTypeDict(){return this.typeDictOv}getTypeDictWhereHasMarketGroupId(){return new m(e=>{setTimeout(()=>g(this,null,function*(){let t=yield d(this.getTypeDict()),i={};for(let r in t){let s=t[r];s.marketGroupID&&(i[r]=s)}e.next(i),e.complete()}))})}getTypeDictByMarketGroupIds(e){return new m(t=>{setTimeout(()=>g(this,null,function*(){let i=new Set(e),r=yield d(this.getTypeDict()),s={};for(let a in r){let p=r[a];i.has(p.typeID)&&(s[a]=p)}t.next(s),t.complete()}))})}getTypeDictWithMarketGroupID(e=null){return new m(t=>{setTimeout(()=>g(this,null,function*(){let i=yield d(this.getTypeDict()),r={};if(e!=null)for(let s in i){let a=i[s];a.marketGroupID==e&&(r[s]=a)}else for(let s in i){let a=i[s];a.marketGroupID&&(r[s]=a)}t.next(i),t.complete()}))})}getTypeDictByTypeIds(e){return new m(t=>{setTimeout(()=>g(this,null,function*(){let i=yield d(this.getTypeDict()),r={};for(let s in e){let a=e[s];r[a]=i[a]}t.next(r),t.complete()}))})}getType(e){return new m(t=>{setTimeout(()=>g(this,null,function*(){let i=yield d(this.getTypeDict());t.next(i[e]??null),t.complete()}))})}static{this.\u0275fac=function(t){return new(t||n)(M(te))}}static{this.\u0275prov=L({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var gi=(()=>{class n{constructor(e){this.httpClient=e,this.blueprintDictOv=new se,this.init().subscribe(()=>{console.log("BlueprintRepositoryService.init DONE")})}init(){return new m(e=>{setTimeout(()=>g(this,null,function*(){let t=yield d(this.httpClient.get("/assets/blueprints.gen.json"));this.blueprintDictOv.setValue(t),e.next(),e.complete()}))})}getBlueprintDict(){return this.blueprintDictOv}getManufacturingProductTypeIds(){return new m(e=>{setTimeout(()=>g(this,null,function*(){let t=yield d(this.getBlueprintDict()),i=new Set;for(let r in t){let a=t[r].activities.manufacturing?.products??[];for(let p=0;p<a.length;p++){let k=a[p];i.add(k.typeID)}}e.next([...i]),e.complete()}))})}getBlueprint(e){return new m(t=>{setTimeout(()=>g(this,null,function*(){let i=yield d(this.getBlueprintDict());t.next(i[e]??null),t.complete()}))})}isBlueprint(e){return new m(t=>{setTimeout(()=>g(this,null,function*(){let i=yield d(this.getBlueprint(e));t.next(i!=null),t.complete()}))})}static{this.\u0275fac=function(t){return new(t||n)(M(te))}}static{this.\u0275prov=L({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var mi=(()=>{class n{constructor(e,t,i,r,s,a,p,k,T){this.orderRepository=e,this.loadingViewManager=t,this.marketGroupRepository=i,this.marketMessage=r,this.keyValueRepository=s,this.typeRepository=a,this.blueprintRepository=p,this.eveEsiApi=k,this.httpClient=T,this.constructLoadingItem=this.loadingViewManager.register("market","\u5E02\u573A\u6570\u636E",1),this.init().subscribe(()=>{this.loadingViewManager.finished(this.constructLoadingItem)})}getMarketNodeType(e){return e=this.parseNode(e),e.key.startsWith("mg_")?ce.MarketGroup:ce.Type}getMarketNodeId(e){e=this.parseNode(e);let t=this.getMarketNodeType(e);return t==ce.MarketGroup?Number(e.key.replace("mg_","")):t==ce.Type?Number(e.key.replace("t_","")):-1}isBlueprintNode(e){return e=this.parseNode(e),e.isBlueprint??!1}parseNode(e){return e instanceof oe?e.origin:e}makeMarketGroupTreeNode(e){return{title:e.name,key:`mg_${e.marketGroupID}`,iconId:e.iconID,children:[]}}makeTypeTreeNode(e){return new m(t=>{setTimeout(()=>g(this,null,function*(){let i={title:e.name,key:`t_${e.typeID}`,isLeaf:!0,isBlueprint:!1,children:[]};(yield d(this.blueprintRepository.getBlueprint(e.typeID)))!=null&&(i.isBlueprint=!0),t.next(i),t.complete()}))})}getMarketTreeNodeOptions(e){let t=this.loadingViewManager.register("MarketService.getMarketTreeNodeOptions","\u5E02\u573A\u7269\u54C1\u7ED3\u6784 \u9996\u6B21\u52A0\u8F7D\u65F6\u95F4\u6BD4\u8F83\u4E45\uFF0C\u8BF7\u8010\u5FC3\u7B49\u5F85",1);return new m(i=>{setTimeout(()=>g(this,null,function*(){let r=[];if(e==ae.Market){if(r=yield d(this.keyValueRepository.getMarketTreeNodes()),r.length==0){let s=yield d(this.httpClient.get("/assets/market-options.cache.json"));s&&(r=s,yield d(this.keyValueRepository.setMarketTreeNodes(r)))}if(r.length==0){let s=yield d(this.typeRepository.getTypeDictWhereHasMarketGroupId()),a=Object.keys(s).map(p=>Number(p));r=yield d(this.getMarketTreeNodeOptionsByTypeIds(a)),yield d(this.keyValueRepository.setMarketTreeNodes(r))}}else if(e==ae.Blueprint){if(r=yield d(this.keyValueRepository.getMarketBlueprintTreeNodes()),r.length==0){let s=yield d(this.httpClient.get("/assets/market-blueprint-options.cache.json"));s&&(r=s,yield d(this.keyValueRepository.setMarketBlueprintTreeNodes(r)))}if(r.length==0){let s=yield d(this.blueprintRepository.getManufacturingProductTypeIds());r=yield d(this.getMarketTreeNodeOptionsByTypeIds(s)),yield d(this.keyValueRepository.setMarketBlueprintTreeNodes(r))}}else{let s=`MarketService.getMarketTreeNodeOptions unknown marketTreeMode: ${e}`;console.error(s),i.error(s)}i.next(r),i.complete(),this.loadingViewManager.finished(t)}))})}getMarketTreeNodeOptionsByTypeIds(e){return new m(t=>{setTimeout(()=>g(this,null,function*(){let i=yield d(this.typeRepository.getTypeDictByTypeIds(e)),r=new Set;for(let y in i){let x=i[y];x&&x.marketGroupID&&r.add(x.marketGroupID)}let s=yield d(this.marketGroupRepository.getMarketGroupDictByIds([...r]));s=yield d(this.marketGroupRepository.getMarketGroupDictByChildren(s));let a={};for(let y in s){let x=s[y],O=x.parentGroupID??0;a[O]||(a[O]=[]),a[O].push(x)}let p={};for(let y in i){let x=i[y],O=x?.marketGroupID??void 0;O&&(p[O]||(p[O]=[]),p[O].push(x))}let k=[],T=a[0];for(let y in T){let x=T[y],O=this.makeMarketGroupTreeNode(x);O.children=yield d(this.getMarketTreeNodeOptionsChildren(x,a,p)),k.push(O)}t.next(k),t.complete()}))})}getMarketTreeNodeOptionsChildren(e,t,i){return new m(r=>{setTimeout(()=>g(this,null,function*(){let s=t[e.marketGroupID]??[],a=[];for(let k in s){let T=s[k],y=T.name;y==""&&(y=T.marketGroupID+"");let x=this.makeMarketGroupTreeNode(T);x.children=yield d(this.getMarketTreeNodeOptionsChildren(T,t,i)),a.push(x)}let p=i[e.marketGroupID]??[];for(let k in p){let T=p[k],y=yield d(this.makeTypeTreeNode(T));a.push(y)}r.next(a),r.complete()}))})}init(){return new m(e=>{setTimeout(()=>g(this,null,function*(){let t=[this.initMarketGroupOptions().pipe(ye(()=>{this.constructLoadingItem.doneStep++})),this.getMarketTreeNodeOptions(ae.Market).pipe(ye(()=>{this.constructLoadingItem.doneStep++})),this.getMarketTreeNodeOptions(ae.Blueprint).pipe(ye(()=>{this.constructLoadingItem.doneStep++}))];this.constructLoadingItem.totalStep+=t.length,yield d(tt(t)),e.next(),e.complete()}))})}initMarketGroupOptions(){return new m(e=>{setTimeout(()=>g(this,null,function*(){e.next(),e.complete()}))})}autoReloadOrdersByJita(e=!1){return this.autoReloadOrdersByRegionId(10000002,e)}autoReloadOrdersByRegionId(e,t=!1){return new m(i=>{setTimeout(()=>g(this,null,function*(){let r=!1;if(t)r=!0;else{let s=yield d(this.orderRepository.getOrdersByRegionId(e));(s==null||Ve.timestampMS()-s.mtime>1e3*60*60)&&(r=!0)}if(!r){i.next(),i.complete();return}yield d(this.orderRepository.reloadOrdersByRegionId(e))}))})}getHistory(e,t){return new m(i=>{setTimeout(()=>g(this,null,function*(){let r=yield d(this.eveEsiApi.marketsRegionHistory(e,t)),s={date:[],average:[],average_20d:[],highest:[],lowest:[],order_count:[],volume:[]},a={averages:[],volumes:[]};for(let p in r){let k=r[p];s.date.push(k.date),s.average.push(k.average),s.highest.push(k.highest),s.lowest.push(k.lowest),s.order_count.push(k.order_count),s.volume.push(k.volume),a.averages.push(k.average),a.volumes.push(k.volume),a.averages.length>20&&(a.averages.shift(),a.volumes.shift());let T=0,y=0;for(let x in a.averages){let O=a.averages[x],ve=a.volumes[x];T+=O*ve,y+=ve}s.average_20d.push(Number(T/y))}i.next(s),i.complete()}))})}getHistoryByNode(e){e=this.parseNode(e);let t=this.getMarketNodeId(e);return this.getHistory(10000002,t)}getNodeImgsrc(e,t=32){if(e=this.parseNode(e),this.getMarketNodeType(e)==ce.Type){let i=this.getMarketNodeId(e);return this.isBlueprintNode(e)?this.imgsrcBlueprint(i,t):this.imgsrcType(i,t)}else if(this.getMarketNodeType(e)==ce.MarketGroup){let i=e.iconId??0;return this.imgsrcMarketGroupIcon(i)}return""}getImgSrcByTypeId(e,t=32){return new m(i=>{setTimeout(()=>g(this,null,function*(){let r;(yield d(this.blueprintRepository.isBlueprint(e)))?r=this.imgsrcBlueprint(e,t):r=this.imgsrcType(e,t),i.next(r),i.complete()}))})}imgsrcBlueprint(e,t){return`https://images.evetech.net/types/${e}/bp?size=${t}`}imgsrcType(e,t){return`https://images.evetech.net/types/${e}/icon?size=${t}`}imgsrcMarketGroupIcon(e){return`https://cn.c3q.cc:20080/eve/market/img/market_groups/${e}.png`}getOrderByNode(e){let t=this.getMarketNodeId(e);return new m(i=>{setTimeout(()=>g(this,null,function*(){let r=yield d(this.orderRepository.getOrdersByTypeId(10000002,t));i.next(r),i.complete()}))})}static{this.\u0275fac=function(t){return new(t||n)(M(Zt),M(Ut),M(hi),M(pi),M(Wt),M(ui),M(gi),M($t),M(te))}}static{this.\u0275prov=L({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var Nn=["nzType","avatar"],_n=["nzType","input"];var Tn=["*"];function wn(n,o){if(n&1&&(z(0,"div",1),S(1,"nz-skeleton-element",4),C()),n&2){let e=l(2);h(),u("nzSize",e.avatar.size||"default")("nzShape",e.avatar.shape||"circle")}}function En(n,o){if(n&1&&S(0,"h3",5),n&2){let e=l(2);G("width",e.toCSSUnit(e.title.width))}}function Dn(n,o){if(n&1&&S(0,"li"),n&2){let e=o.$index,t=l(3);G("width",t.toCSSUnit(t.widthList[e]))}}function xn(n,o){if(n&1&&(z(0,"ul",3),q(1,Dn,1,2,"li",6,fe),C()),n&2){let e=l(2);h(),Y(e.rowsList)}}function Mn(n,o){if(n&1&&(v(0,wn,2,2,"div",1),z(1,"div",0),v(2,En,1,2,"h3",2)(3,xn,3,0,"ul",3),C()),n&2){let e=l();D(e.nzAvatar?0:-1),h(2),D(e.nzTitle?2:-1),h(),D(e.nzParagraph?3:-1)}}function bn(n,o){n&1&&xe(0)}var In=(()=>{class n{constructor(){this.nzActive=!1,this.nzBlock=!1}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275dir=Ne({type:n,selectors:[["nz-skeleton-element"]],hostAttrs:[1,"ant-skeleton","ant-skeleton-element"],hostVars:4,hostBindings:function(t,i){t&2&&_("ant-skeleton-active",i.nzActive)("ant-skeleton-block",i.nzBlock)},inputs:{nzActive:[2,"nzActive","nzActive",c],nzType:"nzType",nzBlock:[2,"nzBlock","nzBlock",c]},standalone:!0,features:[V]})}}return n})();var An=(()=>{class n{constructor(){this.nzShape="circle",this.nzSize="default",this.styleMap={}}ngOnChanges(e){if(e.nzSize&&typeof this.nzSize=="number"){let t=`${this.nzSize}px`;this.styleMap={width:t,height:t,"line-height":t}}else this.styleMap={}}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=I({type:n,selectors:[["nz-skeleton-element","nzType","avatar"]],inputs:{nzShape:"nzShape",nzSize:"nzSize"},standalone:!0,features:[F,A],attrs:Nn,decls:1,vars:9,consts:[[1,"ant-skeleton-avatar",3,"ngStyle"]],template:function(t,i){t&1&&S(0,"span",0),t&2&&(_("ant-skeleton-avatar-square",i.nzShape==="square")("ant-skeleton-avatar-circle",i.nzShape==="circle")("ant-skeleton-avatar-lg",i.nzSize==="large")("ant-skeleton-avatar-sm",i.nzSize==="small"),u("ngStyle",i.styleMap))},dependencies:[Ie],encapsulation:2,changeDetection:0})}}return n})(),Cs=(()=>{class n{constructor(){this.nzSize="default"}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=I({type:n,selectors:[["nz-skeleton-element","nzType","input"]],inputs:{nzSize:"nzSize"},standalone:!0,features:[A],attrs:_n,decls:1,vars:4,consts:[[1,"ant-skeleton-input"]],template:function(t,i){t&1&&S(0,"span",0),t&2&&_("ant-skeleton-input-lg",i.nzSize==="large")("ant-skeleton-input-sm",i.nzSize==="small")},encapsulation:2,changeDetection:0})}}return n})();var fi=(()=>{class n{constructor(e){this.cdr=e,this.nzActive=!1,this.nzLoading=!0,this.nzRound=!1,this.nzTitle=!0,this.nzAvatar=!1,this.nzParagraph=!0,this.rowsList=[],this.widthList=[]}toCSSUnit(e=""){return wt(e)}getTitleProps(){let e=!!this.nzAvatar,t=!!this.nzParagraph,i="";return!e&&t?i="38%":e&&t&&(i="50%"),R({width:i},this.getProps(this.nzTitle))}getAvatarProps(){let e=this.nzTitle&&!this.nzParagraph?"square":"circle";return R({shape:e,size:"large"},this.getProps(this.nzAvatar))}getParagraphProps(){let e=!!this.nzAvatar,t=!!this.nzTitle,i={};return(!e||!t)&&(i.width="61%"),!e&&t?i.rows=3:i.rows=2,R(R({},i),this.getProps(this.nzParagraph))}getProps(e){return e&&typeof e=="object"?e:{}}getWidthList(){let{width:e,rows:t}=this.paragraph,i=[];return e&&Array.isArray(e)?i=e:e&&!Array.isArray(e)&&(i=[],i[t-1]=e),i}updateProps(){this.title=this.getTitleProps(),this.avatar=this.getAvatarProps(),this.paragraph=this.getParagraphProps(),this.rowsList=[...Array(this.paragraph.rows)],this.widthList=this.getWidthList(),this.cdr.markForCheck()}ngOnInit(){this.updateProps()}ngOnChanges(e){(e.nzTitle||e.nzAvatar||e.nzParagraph)&&this.updateProps()}static{this.\u0275fac=function(t){return new(t||n)(N(U))}}static{this.\u0275cmp=I({type:n,selectors:[["nz-skeleton"]],hostAttrs:[1,"ant-skeleton"],hostVars:6,hostBindings:function(t,i){t&2&&_("ant-skeleton-with-avatar",!!i.nzAvatar)("ant-skeleton-active",i.nzActive)("ant-skeleton-round",!!i.nzRound)},inputs:{nzActive:"nzActive",nzLoading:"nzLoading",nzRound:"nzRound",nzTitle:"nzTitle",nzAvatar:"nzAvatar",nzParagraph:"nzParagraph"},exportAs:["nzSkeleton"],standalone:!0,features:[F,A],ngContentSelectors:Tn,decls:2,vars:1,consts:[[1,"ant-skeleton-content"],[1,"ant-skeleton-header"],[1,"ant-skeleton-title",3,"width"],[1,"ant-skeleton-paragraph"],["nzType","avatar",3,"nzSize","nzShape"],[1,"ant-skeleton-title"],[3,"width"]],template:function(t,i){t&1&&(De(),v(0,Mn,4,3,"div",0)(1,bn,1,0)),t&2&&D(i.nzLoading?0:1)},dependencies:[In,An],encapsulation:2,changeDetection:0})}}return n})(),zi=(()=>{class n{static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275mod=K({type:n})}static{this.\u0275inj=j({})}}return n})();var On=["mainElement"];function Bn(n,o){if(n&1){let e=H();z(0,"span",8),B("click",function(){w(e);let i=l(2);return E(i.searchValue="")}),C()}}function Pn(n,o){if(n&1&&v(0,Bn,1,0,"span",7),n&2){let e=l();D(e.searchValue?0:-1)}}function Vn(n,o){n&1&&S(0,"nz-skeleton",9),n&2&&u("nzActive",!0)}function Rn(n,o){if(n&1&&(z(0,"div",10),S(1,"img",11),pe(2),C()),n&2){let e=o.$implicit,t=l();h(),u("src",t.imgsrc(e),Ee),h(),zt(" ",e.title," ")}}var Bs=(()=>{class n{constructor(e){this.marketService=e,this.onNodeClick=new f,this._mode=ae.Market,this.searchValue="",this.treeNodeOptions=[],this.selectedKeys=[],this.checkedKeys=[],this.searchFunc=t=>{try{return this.searchValue==""?!1:t.title.includes(this.searchValue)}catch{return!1}},this.virtualHeight="400px",this.loading=!1}set mode(e){this._mode=e,this.reloadTreeNodeByMode().subscribe()}ngAfterViewInit(){this.reloadTreeNodeByMode().subscribe(),new ResizeObserver(t=>{for(let i of t){let r=i.contentRect.height;this.virtualHeight=r-40+"px"}}).observe(this.mainElementRef.nativeElement)}_onNodeClick(e){if(this.selectedKeys=[],e.node===void 0||e.node===null){console.error("MarketTreeComponent._onNodeClick event.node is undefined or null",e);return}this.onNodeClick.emit(e.node)}imgsrc(e){return this.marketService.getNodeImgsrc(e,32)}reloadTreeNodeByMode(){return new m(e=>{setTimeout(()=>g(this,null,function*(){this.loading=!0,this.treeNodeOptions=[];let t=yield d(this.marketService.getMarketTreeNodeOptions(this._mode));this.treeNodeOptions=t,this.loading=!1,e.next(),e.complete()}))})}static{this.\u0275fac=function(t){return new(t||n)(N(mi))}}static{this.\u0275cmp=I({type:n,selectors:[["app-market-tree"]],viewQuery:function(t,i){if(t&1&&ie(On,5),t&2){let r;X(r=ee())&&(i.mainElementRef=r.first)}},inputs:{mode:"mode"},outputs:{onNodeClick:"onNodeClick"},standalone:!0,features:[A],decls:10,vars:11,consts:[["mainElement",""],["searchClearIcon",""],["nodeTreeTemplate",""],["nzSearch","",3,"nzSuffix"],["nz-input","","placeholder","\u641C\u7D22","type","text",3,"ngModelChange","ngModel","disabled"],[3,"nzActive",4,"ngIf"],["nzBlockNode","","nzHideUnMatched","",3,"nzSelectedKeysChange","nzClick","nzData","nzSelectedKeys","nzSearchValue","nzSearchFunc","nzVirtualHeight","nzVirtualMinBufferPx","nzTreeTemplate"],["nz-icon","","nzTheme","fill","nzType","close-circle",1,"ant-input-clear-icon"],["nz-icon","","nzTheme","fill","nzType","close-circle",1,"ant-input-clear-icon",3,"click"],[3,"nzActive"],[1,"tree-node"],[1,"type-img",3,"src"]],template:function(t,i){if(t&1){let r=H();z(0,"main",null,0)(2,"nz-input-group",3)(3,"input",4),je("ngModelChange",function(a){return w(r),Qe(i.searchValue,a)||(i.searchValue=a),E(a)}),C()(),v(4,Pn,1,1,"ng-template",null,1,ze)(6,Vn,1,1,"nz-skeleton",5),z(7,"nz-tree",6),je("nzSelectedKeysChange",function(a){return w(r),Qe(i.selectedKeys,a)||(i.selectedKeys=a),E(a)}),B("nzClick",function(a){return w(r),E(i._onNodeClick(a))}),C(),v(8,Rn,3,2,"ng-template",null,2,ze),C()}if(t&2){let r=he(5),s=he(9);h(2),u("nzSuffix",r),h(),He("ngModel",i.searchValue),u("disabled",i.loading),h(3),u("ngIf",i.loading),h(),u("nzData",i.treeNodeOptions),He("nzSelectedKeys",i.selectedKeys),u("nzSearchValue",i.searchValue)("nzSearchFunc",i.searchFunc)("nzVirtualHeight",i.virtualHeight)("nzVirtualMinBufferPx",500)("nzTreeTemplate",s)}},dependencies:[_t,Nt,At,Mt,bt,It,li,We,re,ne,Kt,Ht,jt,Qt,zi,fi],styles:[".tree-node[_ngcontent-%COMP%]   .type-img[_ngcontent-%COMP%]{width:24px;height:24px}main[_ngcontent-%COMP%]{height:100%}"]})}}return n})();var Rs="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMIAAADDCAYAAADQvc6UAAABRWlDQ1BJQ0MgUHJvZmlsZQAAKJFjYGASSSwoyGFhYGDIzSspCnJ3UoiIjFJgf8LAwSDCIMogwMCcmFxc4BgQ4ANUwgCjUcG3awyMIPqyLsis7PPOq3QdDFcvjV3jOD1boQVTPQrgSkktTgbSf4A4LbmgqISBgTEFyFYuLykAsTuAbJEioKOA7DkgdjqEvQHEToKwj4DVhAQ5A9k3gGyB5IxEoBmML4BsnSQk8XQkNtReEOBxcfXxUQg1Mjc0dyHgXNJBSWpFCYh2zi+oLMpMzyhRcASGUqqCZ16yno6CkYGRAQMDKMwhqj/fAIcloxgHQqxAjIHBEugw5sUIsSQpBobtQPdLciLEVJYzMPBHMDBsayhILEqEO4DxG0txmrERhM29nYGBddr//5/DGRjYNRkY/l7////39v///y4Dmn+LgeHANwDrkl1AuO+pmgAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAwqADAAQAAAABAAAAwwAAAAD9b/HnAAAHlklEQVR4Ae3dP3PTWBSGcbGzM6GCKqlIBRV0dHRJFarQ0eUT8LH4BnRU0NHR0UEFVdIlFRV7TzRksomPY8uykTk/zewQfKw/9znv4yvJynLv4uLiV2dBoDiBf4qP3/ARuCRABEFAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghgg0Aj8i0JO4OzsrPv69Wv+hi2qPHr0qNvf39+iI97soRIh4f3z58/u7du3SXX7Xt7Z2enevHmzfQe+oSN2apSAPj09TSrb+XKI/f379+08+A0cNRE2ANkupk+ACNPvkSPcAAEibACyXUyfABGm3yNHuAECRNgAZLuYPgEirKlHu7u7XdyytGwHAd8jjNyng4OD7vnz51dbPT8/7z58+NB9+/bt6jU/TI+AGWHEnrx48eJ/EsSmHzx40L18+fLyzxF3ZVMjEyDCiEDjMYZZS5wiPXnyZFbJaxMhQIQRGzHvWR7XCyOCXsOmiDAi1HmPMMQjDpbpEiDCiL358eNHurW/5SnWdIBbXiDCiA38/Pnzrce2YyZ4//59F3ePLNMl4PbpiL2J0L979+7yDtHDhw8vtzzvdGnEXdvUigSIsCLAWavHp/+qM0BcXMd/q25n1vF57TYBp0a3mUzilePj4+7k5KSLb6gt6ydAhPUzXnoPR0dHl79WGTNCfBnn1uvSCJdegQhLI1vvCk+fPu2ePXt2tZOYEV6/fn31dz+shwAR1sP1cqvLntbEN9MxA9xcYjsxS1jWR4AIa2Ibzx0tc44fYX/16lV6NDFLXH+YL32jwiACRBiEbf5KcXoTIsQSpzXx4N28Ja4BQoK7rgXiydbHjx/P25TaQAJEGAguWy0+2Q8PD6/Ki4R8EVl+bzBOnZY95fq9rj9zAkTI2SxdidBHqG9+skdw43borCXO/ZcJdraPWdv22uIEiLA4q7nvvCug8WTqzQveOH26fodo7g6uFe/a17W3+nFBAkRYENRdb1vkkz1CH9cPsVy/jrhr27PqMYvENYNlHAIesRiBYwRy0V+8iXP8+/fvX11Mr7L7ECueb/r48eMqm7FuI2BGWDEG8cm+7G3NEOfmdcTQw4h9/55lhm7DekRYKQPZF2ArbXTAyu4kDYB2YxUzwg0gi/41ztHnfQG26HbGel/crVrm7tNY+/1btkOEAZ2M05r4FB7r9GbAIdxaZYrHdOsgJ/wCEQY0J74TmOKnbxxT9n3FgGGWWsVdowHtjt9Nnvf7yQM2aZU/TIAIAxrw6dOnAWtZZcoEnBpNuTuObWMEiLAx1HY0ZQJEmHJ3HNvGCBBhY6jtaMoEiJB0Z29vL6ls58vxPcO8/zfrdo5qvKO+d3Fx8Wu8zf1dW4p/cPzLly/dtv9Ts/EbcvGAHhHyfBIhZ6NSiIBTo0LNNtScABFyNiqFCBChULMNNSdAhJyNSiECRCjUbEPNCRAhZ6NSiAARCjXbUHMCRMjZqBQiQIRCzTbUnAARcjYqhQgQoVCzDTUnQIScjUohAkQo1GxDzQkQIWejUogAEQo121BzAkTI2agUIkCEQs021JwAEXI2KoUIEKFQsw01J0CEnI1KIQJEKNRsQ80JECFno1KIABEKNdtQcwJEyNmoFCJAhELNNtScABFyNiqFCBChULMNNSdAhJyNSiECRCjUbEPNCRAhZ6NSiAARCjXbUHMCRMjZqBQiQIRCzTbUnAARcjYqhQgQoVCzDTUnQIScjUohAkQo1GxDzQkQIWejUogAEQo121BzAkTI2agUIkCEQs021JwAEXI2KoUIEKFQsw01J0CEnI1KIQJEKNRsQ80JECFno1KIABEKNdtQcwJEyNmoFCJAhELNNtScABFyNiqFCBChULMNNSdAhJyNSiECRCjUbEPNCRAhZ6NSiAARCjXbUHMCRMjZqBQiQIRCzTbUnAARcjYqhQgQoVCzDTUnQIScjUohAkQo1GxDzQkQIWejUogAEQo121BzAkTI2agUIkCEQs021JwAEXI2KoUIEKFQsw01J0CEnI1KIQJEKNRsQ80JECFno1KIABEKNdtQcwJEyNmoFCJAhELNNtScABFyNiqFCBChULMNNSdAhJyNSiEC/wGgKKC4YMA4TAAAAABJRU5ErkJggg==";var Fn=["*"],Hn=["imgRef"],Qn=["imagePreviewWrapper"];function jn(n,o){if(n&1){let e=H();z(0,"div",13),B("click",function(i){w(e);let r=l();return E(r.onSwitchLeft(i))}),S(1,"span",14),C(),z(2,"div",15),B("click",function(i){w(e);let r=l();return E(r.onSwitchRight(i))}),S(3,"span",16),C()}if(n&2){let e=l();_("ant-image-preview-switch-left-disabled",e.index<=0),h(2),_("ant-image-preview-switch-right-disabled",e.index>=e.images.length-1)}}function Kn(n,o){if(n&1&&(z(0,"li",5),pe(1),C()),n&2){let e=l();h(),Ct("",e.index+1," / ",e.images.length,"")}}function Gn(n,o){if(n&1){let e=H();z(0,"li",17),B("click",function(){let i=w(e).$implicit;return E(i.onClick())}),S(1,"span",18),C()}if(n&2){let e,t=o.$implicit,i=l();_("ant-image-preview-operations-operation-disabled",i.zoomOutDisabled&&t.type==="zoomOut"),h(),u("nzType",t.icon)("nzRotate",(e=t.rotate)!==null&&e!==void 0?e:0)}}function Un(n,o){if(n&1&&S(0,"img",20,1),n&2){let e=l().$implicit,t=l();G("width",e.width)("height",e.height)("transform",t.previewImageTransform),me("src",t.sanitizerResourceUrl(e.src),Ee)("srcset",e.srcset)("alt",e.alt)}}function $n(n,o){if(n&1&&v(0,Un,2,9,"img",19),n&2){let e=o.$index,t=l();D(e===t.index?0:-1)}}var Zn=(()=>{class n{constructor(){this.nzScaleStep=null,this.images=[]}addImage(e){this.images.push(e)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=I({type:n,selectors:[["nz-image-group"]],inputs:{nzScaleStep:"nzScaleStep"},exportAs:["nzImageGroup"],standalone:!0,features:[A],ngContentSelectors:Fn,decls:1,vars:0,template:function(t,i){t&1&&(De(),xe(0))},encapsulation:2,changeDetection:0})}}return n})();var Ni="image";function Wn(n){let o={};return n.width<=n.clientWidth&&n.height<=n.clientHeight&&(o={x:0,y:0}),(n.width>n.clientWidth||n.height>n.clientHeight)&&(o={x:vi(n.left,n.width,n.clientWidth),y:vi(n.top,n.height,n.clientHeight)}),o}function Jn(n){let o=n.getBoundingClientRect(),e=document.documentElement;return{left:o.left+(window.pageXOffset||e.scrollLeft)-(e.clientLeft||document.body.clientLeft||0),top:o.top+(window.pageYOffset||e.scrollTop)-(e.clientTop||document.body.clientTop||0)}}function qn(){let n=document.documentElement.clientWidth,o=window.innerHeight||document.documentElement.clientHeight;return{width:n,height:o}}function vi(n,o,e){let t=n+o,i=(o-e)/2,r=null;return o>e?(n>0&&(r=i),n<0&&t<e&&(r=-i)):(n<0||t>e)&&(r=n<0?i:-i),r}var ke=class{constructor(){this.nzKeyboard=!0,this.nzNoAnimation=!1,this.nzMaskClosable=!0,this.nzCloseOnNavigation=!0}},yi={x:0,y:0},Ye=.5,Yn=1,Xn=0,_i=(()=>{class n{get animationDisabled(){return this.config.nzNoAnimation??!1}get maskClosable(){let e=this.nzConfigService.getConfigForComponent(Ni)||{};return this.config.nzMaskClosable??e.nzMaskClosable??!0}constructor(e,t,i,r,s,a){this.ngZone=e,this.cdr=t,this.nzConfigService=i,this.config=r,this.destroy$=s,this.sanitizer=a,this._defaultNzZoom=Yn,this._defaultNzScaleStep=Ye,this._defaultNzRotate=Xn,this.images=[],this.index=0,this.isDragging=!1,this.visible=!0,this.animationStateChanged=new f,this.scaleStepMap=new Map,this.previewImageTransform="",this.previewImageWrapperTransform="",this.operations=[{icon:"close",onClick:()=>{this.onClose()},type:"close"},{icon:"zoom-in",onClick:()=>{this.onZoomIn()},type:"zoomIn"},{icon:"zoom-out",onClick:()=>{this.onZoomOut()},type:"zoomOut"},{icon:"rotate-right",onClick:()=>{this.onRotateRight()},type:"rotateRight"},{icon:"rotate-left",onClick:()=>{this.onRotateLeft()},type:"rotateLeft"},{icon:"swap",onClick:()=>{this.onHorizontalFlip()},type:"flipHorizontally"},{icon:"swap",onClick:()=>{this.onVerticalFlip()},type:"flipVertically",rotate:90}],this.zoomOutDisabled=!1,this.position=R({},yi),this.closeClick=new f,this.zoom=this.config.nzZoom??this._defaultNzZoom,this.scaleStep=this.config.nzScaleStep??this._defaultNzScaleStep,this.rotate=this.config.nzRotate??this._defaultNzRotate,this.flipHorizontally=this.config.nzFlipHorizontally??!1,this.flipVertically=this.config.nzFlipVertically??!1,this.updateZoomOutDisabled(),this.updatePreviewImageTransform(),this.updatePreviewImageWrapperTransform()}ngOnInit(){this.ngZone.runOutsideAngular(()=>{P(this.imagePreviewWrapper.nativeElement,"mousedown").pipe(b(this.destroy$)).subscribe(()=>{this.isDragging=!0}),P(this.imagePreviewWrapper.nativeElement,"wheel").pipe(b(this.destroy$)).subscribe(e=>{this.ngZone.run(()=>this.wheelZoomEventHandler(e))})})}setImages(e,t){t&&(this.scaleStepMap=t),this.images=e,this.markForCheck()}switchTo(e){this.index=e,this.markForCheck()}next(){this.index<this.images.length-1&&(this.reset(),this.index++,this.updatePreviewImageTransform(),this.updatePreviewImageWrapperTransform(),this.updateZoomOutDisabled(),this.markForCheck())}prev(){this.index>0&&(this.reset(),this.index--,this.updatePreviewImageTransform(),this.updatePreviewImageWrapperTransform(),this.updateZoomOutDisabled(),this.markForCheck())}markForCheck(){this.cdr.markForCheck()}onClose(){this.visible=!1,this.closeClick.emit()}onZoomIn(){let e=this.scaleStepMap.get(this.images[this.index].src??this.images[this.index].srcset)??this.scaleStep;this.zoom+=e,this.updatePreviewImageTransform(),this.updateZoomOutDisabled()}onZoomOut(){if(this.zoom>1){let e=this.scaleStepMap.get(this.images[this.index].src??this.images[this.index].srcset)??this.scaleStep;this.zoom-=e,this.updatePreviewImageTransform(),this.updateZoomOutDisabled(),this.zoom<=1&&this.reCenterImage()}}onRotateRight(){this.rotate+=90,this.updatePreviewImageTransform()}onRotateLeft(){this.rotate-=90,this.updatePreviewImageTransform()}onSwitchLeft(e){e.preventDefault(),e.stopPropagation(),this.prev()}onSwitchRight(e){e.preventDefault(),e.stopPropagation(),this.next()}onHorizontalFlip(){this.flipHorizontally=!this.flipHorizontally,this.updatePreviewImageTransform()}onVerticalFlip(){this.flipVertically=!this.flipVertically,this.updatePreviewImageTransform()}wheelZoomEventHandler(e){e.preventDefault(),e.stopPropagation(),this.handlerImageTransformationWhileZoomingWithMouse(e,e.deltaY),this.handleImageScaleWhileZoomingWithMouse(e.deltaY),this.updatePreviewImageWrapperTransform(),this.updatePreviewImageTransform(),this.markForCheck()}onAnimationStart(e){this.animationStateChanged.emit(e)}onAnimationDone(e){this.animationStateChanged.emit(e)}onDragEnd(e){this.isDragging=!1;let t=this.imageRef.nativeElement.offsetWidth*this.zoom,i=this.imageRef.nativeElement.offsetHeight*this.zoom,{left:r,top:s}=Jn(this.imageRef.nativeElement),{width:a,height:p}=qn(),k=this.rotate%180!==0,y=Wn({width:k?i:t,height:k?t:i,left:r,top:s,clientWidth:a,clientHeight:p});Ce(y.x)||Ce(y.y)?this.position=R(R({},this.position),y):!Ce(y.x)&&!Ce(y.y)&&(this.position={x:e.source.getFreeDragPosition().x,y:e.source.getFreeDragPosition().y})}sanitizerResourceUrl(e){return this.sanitizer.bypassSecurityTrustResourceUrl(e)}updatePreviewImageTransform(){this.previewImageTransform=`scale3d(${this.zoom*(this.flipHorizontally?-1:1)}, ${this.zoom*(this.flipVertically?-1:1)}, 1) rotate(${this.rotate}deg)`}updatePreviewImageWrapperTransform(){this.previewImageWrapperTransform=`translate3d(${this.position.x}px, ${this.position.y}px, 0)`}updateZoomOutDisabled(){this.zoomOutDisabled=this.zoom<=1}handlerImageTransformationWhileZoomingWithMouse(e,t){let i,r=this.imageRef.nativeElement,a=getComputedStyle(r).transform.match(/matrix.*\((.+)\)/);a?i=+a[1].split(", ")[0]:i=this.zoom;let p=(e.clientX-r.getBoundingClientRect().x)/i,k=(e.clientY-r.getBoundingClientRect().y)/i,T=t<0?this.scaleStep/2:-this.scaleStep/2;this.position.x+=-p*T*2+r.offsetWidth*T,this.position.y+=-k*T*2+r.offsetHeight*T}handleImageScaleWhileZoomingWithMouse(e){this.isZoomedInWithMouseWheel(e)?this.onZoomIn():this.onZoomOut(),this.zoom<=1&&this.reCenterImage()}isZoomedInWithMouseWheel(e){return e<0}reset(){this.zoom=this.config.nzZoom??this._defaultNzZoom,this.scaleStep=this.config.nzScaleStep??this._defaultNzScaleStep,this.rotate=this.config.nzRotate??this._defaultNzRotate,this.flipHorizontally=!1,this.flipVertically=!1,this.reCenterImage()}reCenterImage(){this.position=R({},yi)}static{this.\u0275fac=function(t){return new(t||n)(N(Te),N(U),N(ue),N(ke),N(Pe),N(Tt))}}static{this.\u0275cmp=I({type:n,selectors:[["nz-image-preview"]],viewQuery:function(t,i){if(t&1&&(ie(Hn,5),ie(Qn,7)),t&2){let r;X(r=ee())&&(i.imageRef=r.first),X(r=ee())&&(i.imagePreviewWrapper=r.first)}},hostAttrs:[1,"ant-image-preview-root"],hostVars:6,hostBindings:function(t,i){t&1&&gt("@fadeMotion.start",function(s){return i.onAnimationStart(s)})("@fadeMotion.done",function(s){return i.onAnimationDone(s)}),t&2&&(ut("@.disabled",i.config.nzNoAnimation)("@fadeMotion",i.visible?"enter":"leave"),G("z-index",i.config.nzZIndex),_("ant-image-preview-moving",i.isDragging))},exportAs:["nzImagePreview"],standalone:!0,features:[Me([Pe]),A],decls:17,vars:5,consts:[["imagePreviewWrapper",""],["imgRef",""],[1,"ant-image-preview-mask"],[1,"ant-image-preview-operations-wrapper"],[1,"ant-image-preview-operations"],[1,"ant-image-preview-operations-progress"],[1,"ant-image-preview-operations-operation",3,"ant-image-preview-operations-operation-disabled"],["tabindex","-1",1,"ant-image-preview-wrap",3,"click"],["role","dialog","aria-modal","true",1,"ant-image-preview"],["tabindex","0","aria-hidden","true",1,"ant-image-preview-focus-trap"],[1,"ant-image-preview-content"],[1,"ant-image-preview-body"],["cdkDrag","",1,"ant-image-preview-img-wrapper",3,"cdkDragEnded","cdkDragFreeDragPosition"],[1,"ant-image-preview-switch-left",3,"click"],["nz-icon","","nzType","left","nzTheme","outline"],[1,"ant-image-preview-switch-right",3,"click"],["nz-icon","","nzType","right","nzTheme","outline"],[1,"ant-image-preview-operations-operation",3,"click"],["nz-icon","","nzTheme","outline",1,"ant-image-preview-operations-icon",3,"nzType","nzRotate"],["cdkDragHandle","",1,"ant-image-preview-img",3,"width","height","transform"],["cdkDragHandle","",1,"ant-image-preview-img"]],template:function(t,i){if(t&1){let r=H();S(0,"div",2),z(1,"div",3),v(2,jn,4,4),z(3,"ul",4),v(4,Kn,2,2,"li",5),q(5,Gn,2,4,"li",6,fe),C()(),z(7,"div",7),B("click",function(a){return w(r),E(i.maskClosable&&a.target===a.currentTarget&&i.onClose())}),z(8,"div",8),S(9,"div",9),z(10,"div",10)(11,"div",11)(12,"div",12,0),B("cdkDragEnded",function(a){return w(r),E(i.onDragEnd(a))}),q(14,$n,1,1,null,null,fe),C()()(),S(16,"div",9),C()()}t&2&&(h(2),D(i.images.length>1?2:-1),h(2),D(i.images.length>1?4:-1),h(),Y(i.operations),h(7),G("transform",i.previewImageWrapperTransform),u("cdkDragFreeDragPosition",i.position),h(2),Y(i.images))},dependencies:[re,ne,Jt,qt],encapsulation:2,data:{animation:[Ot]},changeDetection:0})}}return n})(),Xe=class{constructor(o,e,t){this.previewInstance=o,this.config=e,this.overlayRef=t,this.destroy$=new $,t.keydownEvents().pipe(Fe(i=>this.config.nzKeyboard&&(i.keyCode===27||i.keyCode===37||i.keyCode===39)&&!Pt(i))).subscribe(i=>{i.preventDefault(),i.keyCode===27&&o.onClose(),i.keyCode===37&&this.prev(),i.keyCode===39&&this.next()}),t.detachments().subscribe(()=>{this.overlayRef.dispose()}),o.closeClick.pipe(it(1),nt(()=>o.animationStateChanged),Fe(i=>i.phaseName==="done"),b(this.destroy$)).subscribe(()=>{this.close()})}switchTo(o){this.previewInstance.switchTo(o)}next(){this.previewInstance.next()}prev(){this.previewInstance.prev()}close(){this.destroy$.next(),this.overlayRef.dispose()}},Ti=(()=>{class n{constructor(e,t,i,r){this.overlay=e,this.injector=t,this.nzConfigService=i,this.directionality=r}preview(e,t,i){return this.display(e,t,i)}display(e,t,i){let r=R(R({},new ke),t??{}),s=this.createOverlay(r),a=this.attachPreviewComponent(s,r);a.setImages(e,i);let p=new Xe(a,r,s);return a.previewRef=p,p}attachPreviewComponent(e,t){let i=_e.create({parent:this.injector,providers:[{provide:Rt,useValue:e},{provide:ke,useValue:t}]}),r=new Bt(_i,null,i);return e.attach(r).instance}createOverlay(e){let t=this.nzConfigService.getConfigForComponent(Ni)||{},i=new Vt({scrollStrategy:this.overlay.scrollStrategies.block(),positionStrategy:this.overlay.position().global(),disposeOnNavigation:e.nzCloseOnNavigation??t.nzCloseOnNavigation??!0,direction:e.nzDirection||t.nzDirection||this.directionality.value});return this.overlay.create(i)}static{this.\u0275fac=function(t){return new(t||n)(M(Ft),M(_e),M(ue),M(Se))}}static{this.\u0275prov=L({token:n,factory:n.\u0275fac})}}return n})(),er="image",uo=(()=>{class n{get previewable(){return!this.nzDisablePreview&&this.status!=="error"}constructor(e,t,i,r,s){this.nzConfigService=e,this.elementRef=t,this.nzImageService=i,this.cdr=r,this.directionality=s,this._nzModuleName=er,this.nzSrc="",this.nzSrcset="",this.nzDisablePreview=!1,this.nzFallback=null,this.nzPlaceholder=null,this.nzScaleStep=null,this.status="normal",this.backLoadDestroy$=new $,this.destroy$=new $,this.document=J(yt),this.parentGroup=J(Zn,{optional:!0})}ngOnInit(){this.backLoad(),this.parentGroup&&this.parentGroup.addImage(this),this.directionality&&(this.directionality.change?.pipe(b(this.destroy$)).subscribe(e=>{this.dir=e,this.cdr.detectChanges()}),this.dir=this.directionality.value)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}onPreview(){if(this.previewable)if(this.parentGroup){let e=this.parentGroup.images.filter(a=>a.previewable),t=e.map(a=>({src:a.nzSrc,srcset:a.nzSrcset})),i=e.findIndex(a=>this===a),r=new Map;e.forEach(a=>{r.set(a.nzSrc??a.nzSrcset,a.nzScaleStep??this.parentGroup.nzScaleStep??this.nzScaleStep??Ye)}),this.nzImageService.preview(t,{nzDirection:this.dir},r).switchTo(i)}else{let e=[{src:this.nzSrc,srcset:this.nzSrcset}];this.nzImageService.preview(e,{nzDirection:this.dir,nzScaleStep:this.nzScaleStep??Ye})}}getElement(){return this.elementRef}ngOnChanges(e){let{nzSrc:t}=e;t&&(this.getElement().nativeElement.src=t.currentValue,this.backLoad())}backLoad(){this.backLoadImage=this.document.createElement("img"),this.backLoadImage.src=this.nzSrc,this.backLoadImage.srcset=this.nzSrcset,this.status="loading",this.backLoadDestroy$.next(),this.backLoadDestroy$.complete(),this.backLoadDestroy$=new $,this.backLoadImage.complete?(this.status="normal",this.getElement().nativeElement.src=this.nzSrc,this.getElement().nativeElement.srcset=this.nzSrcset):(this.nzPlaceholder?(this.getElement().nativeElement.src=this.nzPlaceholder,this.getElement().nativeElement.srcset=""):(this.getElement().nativeElement.src=this.nzSrc,this.getElement().nativeElement.srcset=this.nzSrcset),P(this.backLoadImage,"load").pipe(b(this.backLoadDestroy$),b(this.destroy$)).subscribe(()=>{this.status="normal",this.getElement().nativeElement.src=this.nzSrc,this.getElement().nativeElement.srcset=this.nzSrcset}),P(this.backLoadImage,"error").pipe(b(this.backLoadDestroy$),b(this.destroy$)).subscribe(()=>{this.status="error",this.nzFallback&&(this.getElement().nativeElement.src=this.nzFallback,this.getElement().nativeElement.srcset="")}))}static{this.\u0275fac=function(t){return new(t||n)(N(ue),N(we),N(Ti),N(U),N(Se))}}static{this.\u0275dir=Ne({type:n,selectors:[["img","nz-image",""]],hostBindings:function(t,i){t&1&&B("click",function(){return i.onPreview()})},inputs:{nzSrc:"nzSrc",nzSrcset:"nzSrcset",nzDisablePreview:[2,"nzDisablePreview","nzDisablePreview",c],nzFallback:"nzFallback",nzPlaceholder:"nzPlaceholder",nzScaleStep:"nzScaleStep"},exportAs:["nzImage"],standalone:!0,features:[V,F]})}}return Z([W()],n.prototype,"nzDisablePreview",void 0),Z([W()],n.prototype,"nzFallback",void 0),Z([W()],n.prototype,"nzPlaceholder",void 0),Z([W()],n.prototype,"nzScaleStep",void 0),n})(),go=(()=>{class n{static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275mod=K({type:n})}static{this.\u0275inj=j({providers:[Ti],imports:[_i]})}}return n})();export{li as a,zn as b,Lr as c,ce as d,In as e,Cs as f,fi as g,zi as h,di as i,ui as j,gi as k,mi as l,Bs as m,Rs as n,uo as o,go as p};

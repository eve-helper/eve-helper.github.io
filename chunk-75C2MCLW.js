import{e as q}from"./chunk-HI6QFCUV.js";import{i as G,j as H,k as J,l as Q,o as X,p as Y,r as Z,s as ee,t as te,u as ie}from"./chunk-XEDTK6YW.js";import{a as U,c as K,i as ne,j as oe,k as ae,l as le,m as pe,n as se,p as me}from"./chunk-XTTU5SCV.js";import"./chunk-OSFVWQ5Z.js";import{V as L,jb as $,l as M,ma as W,vb as re}from"./chunk-P3XE2YTL.js";import{t as A}from"./chunk-WV4YJ4QP.js";import{Bb as C,Ca as y,Da as I,Ib as S,Kb as N,Lb as _,Mb as c,Nb as p,Ob as B,Sb as k,Yb as j,_b as F,c as u,db as D,fc as V,ga as b,gb as m,gc as f,ha as x,hb as T,ic as w,la as g,lc as E,mc as R,nc as O,pc as P,ra as v,s as a,sa as z}from"./chunk-NPSVTU3I.js";import{e as l}from"./chunk-JKOY2XUY.js";var ue=(()=>{class r{constructor(e,t,i){this.blueprintRepository=e,this.typeRepository=t,this.loadingViewManager=i,this.isInit=!1,this.typeIdBlueprintTypeIdDict=new Map;let n=this.loadingViewManager.register("BlueprintService","\u84DD\u56FE\u6570\u636E",1);this.init().subscribe(()=>{this.loadingViewManager.finished(n)})}waitUntilInit(){return ne(this)}init(){return new u(e=>{setTimeout(()=>l(this,null,function*(){let t=yield a(this.blueprintRepository.getBlueprintDict());for(let i in t){let n=t[i],s=n.activities.manufacturing?.products??[];for(let o=0;o<s.length;o++){let d=s[o];this.typeIdBlueprintTypeIdDict.set(d.typeID,n.blueprintTypeID)}}this.isInit=!0,e.next(),e.complete()}))})}getBlueprintMaterials(e){return new u(t=>{setTimeout(()=>l(this,null,function*(){let i=yield a(this.blueprintRepository.getBlueprint(e));if(i==null){t.next([]),t.complete(),console.warn("BlueprintService.getBlueprintMaterials",`blueprint[${e}] is null`);return}let n=i.activities.manufacturing?.materials??[],s=[];for(let o in n){let d=n[o],h=yield a(this.typeRepository.getType(d.typeID));if(h==null){console.warn("BlueprintService.getBlueprintMaterials",`type[${d.typeID}] is null`);continue}s.push({typeId:h.typeID,name:h.name,quantity:d.quantity})}t.next(s),t.complete()}))})}getBlueprintMaterialsByTypeId(e){return new u(t=>{setTimeout(()=>l(this,null,function*(){let i=yield a(this.getBlueprintTypeIdByTypeId(e));if(i==null){t.next([]),t.complete(),console.warn("BlueprintService.getBlueprintMaterialsByTypeId",`typeId[${e}] not found blueprintTypeId`);return}t.next(yield a(this.getBlueprintMaterials(i))),t.complete()}))})}getTypeIdBlueprintTypeIdDict(){return new u(e=>{setTimeout(()=>l(this,null,function*(){yield a(this.waitUntilInit()),e.next(this.typeIdBlueprintTypeIdDict),e.complete()}))})}getBlueprintTypeIdByTypeId(e){return new u(t=>{setTimeout(()=>l(this,null,function*(){let i=yield a(this.getTypeIdBlueprintTypeIdDict());t.next(i.get(e)??null),t.complete()}))})}static{this.\u0275fac=function(t){return new(t||r)(g(ae),g(oe),g(re))}}static{this.\u0275prov=b({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();function he(r,fe){if(r&1&&(c(0,"tr")(1,"td"),B(2,"img",8),f(3),p(),c(4,"td"),f(5),p()()),r&2){let e=fe.$implicit,t=F();m(2),C("src",t.imgsrc(e.typeId),D),m(),w(" ",e.name," "),m(2),w(" ",e.quantity," ")}}var de=(()=>{class r{constructor(e,t){this.blueprintService=e,this.marketService=t,this.selectedTabIndex=0,this.tableData=[],this.materialImgsrcDict={},this.singleTypeId=0,this.fallbackImageBase64=se}ngOnInit(){}onNodeClick(e){setTimeout(()=>l(this,null,function*(){let t=this.getTypeNodeId(e),i=yield a(this.blueprintService.getBlueprintMaterialsByTypeId(t));this.tableData=i}))}imgsrc(e){return this.materialImgsrcDict[e]&&this.materialImgsrcDict[e]!="error"?this.materialImgsrcDict[e]:(this.materialImgsrcDict[e]="error",this.marketService.getImgSrcByTypeId(e).subscribe(t=>{this.materialImgsrcDict[e]=t}),this.materialImgsrcDict[e])}getTypeNodeId(e){return e.key.startsWith("t_")?parseInt(e.key.substring(2)):0}static{this.\u0275fac=function(t){return new(t||r)(T(ue),T(le))}}static{this.\u0275cmp=v({type:r,selectors:[["app-blueprint-compute"]],standalone:!0,features:[P],decls:17,vars:2,consts:[["singleTable",""],[1,"left"],["mode","blueprint",3,"onNodeClick"],[1,"right"],[3,"nzSelectedIndexChange","nzSelectedIndex"],["nzTitle","\u5355\u7269\u54C1"],["nzSize","small",3,"nzData"],["nzTitle","\u591A\u7269\u54C1"],["width","32px","height","32px",3,"src"]],template:function(t,i){if(t&1){let n=k();c(0,"main")(1,"div",1)(2,"app-market-tree",2),j("onNodeClick",function(o){return y(n),I(i.onNodeClick(o))}),p()(),c(3,"div",3)(4,"nz-tabset",4),O("nzSelectedIndexChange",function(o){return y(n),R(i.selectedTabIndex,o)||(i.selectedTabIndex=o),I(o)}),c(5,"nz-tab",5)(6,"nz-table",6,0)(8,"thead")(9,"tr")(10,"th"),f(11,"\u6750\u6599"),p(),c(12,"th"),f(13,"\u6570\u91CF"),p()(),N(14,he,6,3,"tr",null,S),p()()(),B(16,"nz-tab",7),p()()()}if(t&2){let n=V(7);m(4),E("nzSelectedIndex",i.selectedTabIndex),m(2),C("nzData",i.tableData),m(8),_(n.data)}},dependencies:[U,q,W,$,L,G,K,A,Q,J,H,ie,Z,X,Y,te,ee,pe,me],styles:["main[_ngcontent-%COMP%]{width:100%;height:100%;justify-content:flex-start;align-items:flex-start;display:flex}.left[_ngcontent-%COMP%]{width:300px;height:100%}.right[_ngcontent-%COMP%]{width:calc(100% - 300px);padding-left:10px;height:100%}.tree-node[_ngcontent-%COMP%]   .type-img[_ngcontent-%COMP%]{width:24px;height:24px}"]})}}return r})();var ye=[{path:"",component:de}],$e=(()=>{class r{static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275mod=z({type:r})}static{this.\u0275inj=x({imports:[M.forChild(ye),M]})}}return r})();export{$e as BlueprintComputeRoutingModule};
